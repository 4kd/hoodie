<!DOCTYPE html>
<html>
<head>
  <title>Hoodie Test page</title>

  <!-- deplendencies for hoodie -->
  <script src="vendor/jquery-1.7.2.min.js"></script>
  <script src="hoodie.js"></script>
  
  <link href="http://google-code-prettify.googlecode.com/svn/trunk/styles/sunburst.css" type="text/css" rel="stylesheet" />
  
  
</head>
<body>
  
  <div class="container" style="margin: 50px auto; max-width: 920px;">
    <pre class="prettyprint"><code class="language-js">
    // initialize your Hoodie App
    
    hoodieAppUrl = 'http://myapp.hood.ie';
    hoodie = new Hoodie(hoodieAppUrl)
    
    // 
    // Account 
    //
    
    // sign up
    hoodie.my.account.signUp('joe@example.com', 'secret')
      .done( function(user) { } ) 
      .fail( function(err)  { } )
      
    // sign in
    hoodie.my.account.signIn('joe@example.com', 'secret')
      .done( function(user) { } ) 
      .fail( function(err)  { } )
      
    // sign out
    hoodie.my.account.signOut()
      .done( function(user) { } ) 
      .fail( function(err)  { } )
    
    // change password
    hoodie.my.account.changePassword('currentpassword', 'newpassword')
      .done( function(user) { } ) 
      .fail( function(err)  { } )

    // change username
    hoodie.my.account.changeUsername('currentpassword', 'newusername')
      .done( function(user) { } ) 
      .fail( function(err)  { } )
      
    // reset password
    hoodie.my.account.resetPassword('joe@example.com')
      .done( function(user) { } ) 
      .fail( function(err)  { } )

    // destroy account and all its data
    hoodie.my.account.destroy()
      .done( function(user) { } ) 
      .fail( function(err)  { } )
      
    //
    // Store
    //
    
    // helper to generate uuids
    uuid = hoodie.my.store.uuid(length)
    
    // create a new object
    type = 'couch'
    attributes = {color: "red"}
    hoodie.my.store.create(type, attributes )
      .done ( function(newObject) { } )
      .fail ( function(err)        { } )
      
    // save an object
    type = 'couch'
    id   = 'abc4567'
    attributes  = {color: "red", name: "relax"}
    hoodie.my.store.save( type, id, attributes )
      .done ( function(object) { } )
      .fail ( function(err)        { } )
      
    // update an existing object
    type = 'couch'
    id   = 'abc4567'
    update = {size: 2}
    hoodie.my.store.update( type, id, update )
      .done ( function(updatedObject) { } )
      .fail ( function(err)            { } )
    
    // find one object
    type = 'couch'
    id   = 'abc4567'
    hoodie.my.store.find( type, id )
      .done ( function(object) { } )
      .fail ( function(err)    { } )
      
    // Load all objects
    hoodie.my.store.findAll()
      .done ( function(objects) { } )
      .fail ( function(err)     { } )
      
    // Load all objects from one type
    type = 'couch'
    hoodie.my.store.findAll( type )
      .done ( function(objects) { } )
      .fail ( function(err)     { } )
      
    // destroy an existing object
    type = 'couch'
    id   = 'abc4567'
    hoodie.my.store.destroy( type, id )
      .done ( function(destroyedObject) { } )
      .fail ( function(err)             { } )
      
    //
    // Synchronization
    //
    // When signed in, local changes do get synched automatically.
    // You can subscribe to remote updates
    // 
    
    // new doc created
    hoodie.my.remote.on( 'create', function( createdObject) { } )

    // existing doc updated
    hoodie.my.remote.on( 'update', function( updatedObject) { } )

    // doc destroyed
    hoodie.my.remote.on( 'destroy', function( destroyedObject) { } )

    // any of above events
    hoodie.my.remote.on( 'change', function( event, changedObject) { } )

    // all listeners can be filtered by type
    hoodie.my.remote.on( "create:couch",  function( createdObject) { } )
    hoodie.my.remote.on( "update:couch",  function( updatedObject)  { } )
    hoodie.my.remote.on( "destroy:couch", function( destroyedObject) { } )
    hoodie.my.remote.on( "change:couch",  function( event, changedObject) { } )

    // ... and by type and id
    hoodie.my.remote.on( "create:couch:uuid123",  function( createdObject) { } )
    hoodie.my.remote.on( "update:couch:uuid123",  function( updatedObject)  { } )
    hoodie.my.remote.on( "destroy:couch:uuid123", function( destroyedObject) { } )
    hoodie.my.remote.on( "change:couch:uuid123",  function( event, changedObject) { } )


    //
    // Public Shares (Public User Stores)
    //
    // Select data you want to share with others and control exactly what will
    // be shared
    //

    // make couch object with id "abc4567" public
    hoodie.my.store.update("couch","abc4567", {}, {public: true})

    // make couch with id "abc4567" public, but do only show the color, hide
    // all other attributes
    hoodie.my.store.update("couch","abc4567", {}, {public: ["color"]})

    // make couch with id "abc4567" private again
    hoodie.my.store.update("couch","abc4567", {}, {public: false})

    // find all couch objects from user "joe"
    hoodie.user("joe").findAll("couch").done( function(couches) { ... })


    //
    // Global Public Store
    // 
    // When enabled, all publicly shared objects by all users will be 
    // available through the hoodie.global API
    //

    // find all public songs from all users
    hoodie.global.findAll("song").done( function(songs) { ... })

    
    //
    // Sharing
    //
    // The hoodie.share module allows to share objects with other users. A share
    // can be public, which means everybody knowing its id can access it. Or the 
    // access can be limited to specific users. Optionally, a password can be set
    // for additional security. Access can be differenciated between read and write.
    //

    // create a new share
    share = hoodie.share.create()

    // update access settings and set a password
    share.update({access: {read: true}}, password: 'secret')

    // add all todo objects to the share
    share.add( hoodie.my.store.loadAll('todo') )

    // remove a specific todo from the share
    share.remove( todoObject );

    // destroy share
    share.destroy()
    
    
    //
    // Send emails
    // 
    email = {
      to      : ['you@roundthewor.ld'],
      cc      : ['rest@roundthewor.ld'],
      subject : 'rule the wolrd',
      body    : "we can do it!\nSigned, Joe"
    }

    hoodie.email.send( email )

      // synched to server
      .progress ( function(email) { } )

      // email sent successfully
      .done     ( function(email) { } )

      // something went wrong
      .fail     ( function(err)   { } )
    </code></pre>
  </div>
  
  <!-- <link href="http://google-code-prettify.googlecode.com/svn/trunk/src/prettify.css" type="text/css" rel="stylesheet" /> -->
  <script src="http://google-code-prettify.googlecode.com/svn/trunk/src/prettify.js"></script>
  <script>
    if (typeof prettyPrint == 'function') {
      prettyPrint()
    };
  </script>
  
  
</body>
</html>