// Generated by CoffeeScript 1.3.3
var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Hoodie.Account.RemoteStore = (function(_super) {

  __extends(RemoteStore, _super);

  RemoteStore.prototype._sync = true;

  function RemoteStore() {
    this.push = __bind(this.push, this);

    this.connect = __bind(this.connect, this);

    this.stopSyncing = __bind(this.stopSyncing, this);

    this.startSyncing = __bind(this.startSyncing, this);
    RemoteStore.__super__.constructor.apply(this, arguments);
    this.storeName = this.hoodie.my.account.db();
    if (this.hoodie.my.config.get('_remote.sync') != null) {
      this._sync = this.hoodie.my.config.get('_remote.sync');
    }
    if (this.isContinuouslySyncing()) {
      this.startSyncing();
    }
  }

  RemoteStore.prototype.startSyncing = function() {
    this.hoodie.my.config.set('_remote.sync', this._sync = true);
    this.hoodie.on('account:signout', this.disconnect);
    this.hoodie.on('account:signin', this.connect);
    return this.connect();
  };

  RemoteStore.prototype.stopSyncing = function() {
    this.hoodie.my.config.set('_remote.sync', this._sync = false);
    this.hoodie.unbind('account:signin', this.connect);
    this.hoodie.unbind('account:signout', this.disconnect);
    return this.disconnect();
  };

  RemoteStore.prototype.connect = function() {
    var _this = this;
    return this.hoodie.my.account.authenticate().pipe(function() {
      return RemoteStore.__super__.connect.apply(_this, arguments);
    });
  };

  RemoteStore.prototype.getSinceNr = function(since) {
    return this.hoodie.my.config.get('_remote.since') || 0;
  };

  RemoteStore.prototype.setSinceNr = function(since) {
    return this.hoodie.my.config.set('_remote.since', since);
  };

  RemoteStore.prototype.push = function(docs) {
    if (!$.isArray(docs)) {
      docs = this.hoodie.my.store.changedDocs();
    }
    return RemoteStore.__super__.push.call(this, docs);
  };

  return RemoteStore;

})(Hoodie.RemoteStore);
