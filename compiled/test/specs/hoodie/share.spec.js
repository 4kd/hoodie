// Generated by CoffeeScript 1.3.3

describe("Hoodie.Share", function() {
  beforeEach(function() {
    this.hoodie = new Mocks.Hoodie;
    this.share = new Hoodie.Share(this.hoodie);
    return spyOn(this.share, "instance");
  });
  describe("constructor", function() {
    it("should set Hoodie.ShareInstance.prototype.hoodie", function() {
      var instance;
      new Hoodie.Share(this.hoodie);
      instance = new Hoodie.ShareInstance;
      return expect(instance.hoodie).toBe(this.hoodie);
    });
    return it("should return the @open method as api", function() {
      var share;
      spyOn(Hoodie.Share.prototype, "open");
      share = new Hoodie.Share(this.hoodie);
      share('funk');
      return expect(Hoodie.Share.prototype.open).wasCalledWith('funk');
    });
  });
  describe("direct call", function() {
    beforeEach(function() {
      return spyOn(Hoodie.Share.prototype, "open");
    });
    return it("should initiate a new Share Instance and pass options", function() {
      var share;
      share = new Hoodie.Share(this.hoodie);
      share('funk');
      return expect(Hoodie.Share.prototype.open).wasCalledWith('funk');
    });
  });
  describe("#instance", function() {
    return it("should point to Hoodie.ShareInstance", function() {
      var share;
      share = new Hoodie.Share(this.hoodie);
      return expect(share.instance).toBe(Hoodie.ShareInstance);
    });
  });
  describe("#open(shareId, options)", function() {
    beforeEach(function() {
      return spyOn(this.hoodie, "open");
    });
    return it("should proxy to hoodie.open('share/' + shareId, {prefix: 'share/shareId'}) and pass options", function() {
      this.share('funk123', {
        option: 'value'
      });
      return expect(this.hoodie.open).wasCalledWith('share/funk123', {
        prefix: 'share/funk123',
        option: 'value'
      });
    });
  });
  describe("#create(attributes)", function() {
    beforeEach(function() {
      this.instance = jasmine.createSpy("instance");
      this.instance.save = jasmine.createSpy("save");
      return this.share.instance.andReturn(this.instance);
    });
    return it("should initiate a new Hoodie.ShareInstance and save it", function() {
      var returnValue;
      returnValue = this.share.create({
        funky: 'fresh'
      });
      expect(this.share.instance).wasCalledWith({
        funky: 'fresh'
      });
      expect(this.instance.save).wasCalled();
      return expect(returnValue).toBe(this.instance);
    });
  });
  describe("#find(share_id)", function() {
    beforeEach(function() {
      var promise;
      promise = this.hoodie.defer().resolve({
        funky: 'fresh'
      }).promise();
      spyOn(this.hoodie.store, "find").andReturn(promise);
      return this.share.instance.andCallFake(function() {
        return this.foo = 'bar';
      });
    });
    it("should proxy to store.find('$share', share_id)", function() {
      var promise;
      promise = this.share.find('123');
      return expect(this.hoodie.store.find).wasCalledWith('$share', '123');
    });
    return it("should resolve with a Share Instance", function() {
      var promise;
      this.hoodie.store.find.andReturn(this.hoodie.defer().resolve({}).promise());
      this.share.instance.andCallFake(function() {
        return this.foo = 'bar';
      });
      promise = this.share.find('123');
      return expect(promise).toBeResolvedWith({
        foo: 'bar'
      });
    });
  });
  describe("#findOrCreate(id, share_attributes)", function() {
    beforeEach(function() {
      return spyOn(this.hoodie.store, "findOrCreate").andCallThrough();
    });
    it("should proxy to hoodie.store.findOrCreate with type set to '$share'", function() {
      this.share.findOrCreate('id123', {});
      return expect(this.hoodie.store.findOrCreate).wasCalledWith('$share', 'id123', {});
    });
    return it("should resolve with a Share Instance", function() {
      var promise;
      this.hoodie.store.findOrCreate.andReturn(this.hoodie.defer().resolve({}).promise());
      this.share.instance.andCallFake(function() {
        return this.foo = 'bar';
      });
      promise = this.share.findOrCreate('id123', {});
      return expect(promise).toBeResolvedWith({
        foo: 'bar'
      });
    });
  });
  describe("#findAll()", function() {
    beforeEach(function() {
      return spyOn(this.hoodie.store, "findAll").andCallThrough();
    });
    it("should proxy to hoodie.store.findAll('$share')", function() {
      this.hoodie.store.findAll.andCallThrough();
      this.share.findAll();
      return expect(this.hoodie.store.findAll).wasCalledWith('$share');
    });
    return it("should resolve with an array of Share instances", function() {
      var promise;
      this.hoodie.store.findAll.andReturn(this.hoodie.defer().resolve([{}, {}]).promise());
      this.share.instance.andCallFake(function() {
        return this.foo = 'bar';
      });
      promise = this.share.findAll();
      return expect(promise).toBeResolvedWith([
        {
          foo: 'bar'
        }, {
          foo: 'bar'
        }
      ]);
    });
  });
  describe("#save('share_id', attributes)", function() {
    beforeEach(function() {
      return spyOn(this.hoodie.store, "save").andCallThrough();
    });
    it("should proxy to hoodie.store.save('$share', 'share_id', attributes)", function() {
      this.share.save('abc4567', {
        funky: 'fresh'
      });
      return expect(this.hoodie.store.save).wasCalledWith('$share', 'abc4567', {
        funky: 'fresh'
      });
    });
    return it("should resolve with a Share Instance", function() {
      var promise;
      this.hoodie.store.save.andReturn(this.hoodie.defer().resolve({}).promise());
      this.share.instance.andCallFake(function() {
        return this.foo = 'bar';
      });
      promise = this.share.save({});
      return expect(promise).toBeResolvedWith({
        foo: 'bar'
      });
    });
  });
  describe("#update('share_id', changed_attributes)", function() {
    beforeEach(function() {
      return spyOn(this.hoodie.store, "update").andCallThrough();
    });
    it("should proxy to hoodie.store.update('$share', 'share_id', attributes)", function() {
      this.share.update('abc4567', {
        funky: 'fresh'
      });
      return expect(this.hoodie.store.update).wasCalledWith('$share', 'abc4567', {
        funky: 'fresh'
      });
    });
    return it("should resolve with a Share Instance", function() {
      var promise;
      this.hoodie.store.update.andReturn(this.hoodie.defer().resolve({}).promise());
      this.share.instance.andCallFake(function() {
        return this.foo = 'bar';
      });
      promise = this.share.update({});
      return expect(promise).toBeResolvedWith({
        foo: 'bar'
      });
    });
  });
  describe("#updateAll(changed_attributes)", function() {
    beforeEach(function() {
      return spyOn(this.hoodie.store, "updateAll").andCallThrough();
    });
    it("should proxy to hoodie.store.updateAll('$share', changed_attributes)", function() {
      this.hoodie.store.updateAll.andCallThrough();
      this.share.updateAll({
        funky: 'fresh'
      });
      return expect(this.hoodie.store.updateAll).wasCalledWith('$share', {
        funky: 'fresh'
      });
    });
    return it("should resolve with an array of Share instances", function() {
      var promise;
      this.hoodie.store.updateAll.andReturn(this.hoodie.defer().resolve([{}, {}]).promise());
      this.share.instance.andCallFake(function() {
        return this.foo = 'bar';
      });
      promise = this.share.updateAll({
        funky: 'fresh'
      });
      return expect(promise).toBeResolvedWith([
        {
          foo: 'bar'
        }, {
          foo: 'bar'
        }
      ]);
    });
  });
  describe("#destroy(share_id)", function() {
    beforeEach(function() {
      var promise;
      promise = this.hoodie.defer().resolve({
        funky: 'fresh'
      }).promise();
      spyOn(this.hoodie.store, "find").andReturn(promise);
      return this.share.instance = (function() {

        function instance() {}

        instance.prototype.destroy = function() {
          return 'delete_promise';
        };

        return instance;

      })();
    });
    it("should try to find the object with store.find('$share', share_id)", function() {
      var promise;
      promise = this.share.destroy('123');
      return expect(this.hoodie.store.find).wasCalledWith('$share', '123');
    });
    return it("should init the share instance and destroy it", function() {
      var promise;
      this.hoodie.store.find.andReturn(this.hoodie.defer().resolve({}).promise());
      promise = this.share.destroy('123');
      return expect(promise).toBeResolvedWith('delete_promise');
    });
  });
  return describe("#destroyAll()", function() {
    beforeEach(function() {
      var promise;
      promise = this.hoodie.defer().resolve([
        {
          funky: 'fresh'
        }, {
          funky: 'fresh'
        }
      ]).promise();
      spyOn(this.hoodie.store, "findAll").andReturn(promise);
      return this.share.instance = (function() {

        function instance() {}

        instance.prototype.destroy = function() {
          return 'destroyAll_promise';
        };

        return instance;

      })();
    });
    it("should try to find the object with store.findAll('$share')", function() {
      var promise;
      promise = this.share.destroyAll();
      return expect(this.hoodie.store.findAll).wasCalled();
    });
    return it("should init the share instance and destroy it", function() {
      var promise;
      this.hoodie.store.findAll.andReturn(this.hoodie.defer().resolve([{}, {}]).promise());
      promise = this.share.destroyAll();
      return expect(promise).toBeResolvedWith(['destroyAll_promise', 'destroyAll_promise']);
    });
  });
});
