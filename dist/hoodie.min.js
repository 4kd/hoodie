// Hoodie.js - 0.9.2
// https://github.com/hoodiehq/hoodie.js
// Copyright 2012 - 2014 https://github.com/hoodiehq/
// Licensed Apache License 2.0

!function(a){"object"==typeof exports?module.exports=a():"function"==typeof define&&define.amd?define(a):"undefined"!=typeof window?window.Hoodie=a():"undefined"!=typeof global?global.Hoodie=a():"undefined"!=typeof self&&(self.Hoodie=a())}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){"use strict";function c(a){return function(){var b=arguments.length;if(b){for(var c=[],d=-1;++d<b;)c[d]=arguments[d];return a.call(this,c)}return a.call(this,[])}}b.exports=c},{}],2:[function(){},{}],3:[function(a,b){var c=b.exports={};c.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};if(b){var c=[];return window.addEventListener("message",function(a){var b=a.source;if((b===window||null===b)&&"process-tick"===a.data&&(a.stopPropagation(),c.length>0)){var d=c.shift();d()}},!0),function(a){c.push(a),window.postMessage("process-tick","*")}}return function(a){setTimeout(a,0)}}(),c.title="browser",c.browser=!0,c.env={},c.argv=[],c.binding=function(){throw new Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(){throw new Error("process.chdir is not supported")}},{}],4:[function(a,b){function c(a){if(!a||"[object Object]"!==e.call(a)||a.nodeType||a.setInterval)return!1;var b=d.call(a,"constructor"),c=d.call(a.constructor.prototype,"isPrototypeOf");if(a.constructor&&!b&&!c)return!1;var f;for(f in a);return void 0===f||d.call(a,f)}var d=Object.prototype.hasOwnProperty,e=Object.prototype.toString;b.exports=function f(){var a,b,d,e,g,h,i=arguments[0]||{},j=1,k=arguments.length,l=!1;for("boolean"==typeof i&&(l=i,i=arguments[1]||{},j=2),"object"!=typeof i&&"function"!=typeof i&&(i={});k>j;j++)if(null!=(a=arguments[j]))for(b in a)d=i[b],e=a[b],i!==e&&(l&&e&&(c(e)||(g=Array.isArray(e)))?(g?(g=!1,h=d&&Array.isArray(d)?d:[]):h=d&&c(d)?d:{},i[b]=f(l,h,e)):void 0!==e&&(i[b]=e));return i}},{}],5:[function(a,b){function c(a){return f(function(b){var c,f=this,g="function"==typeof b[b.length-1]?b.pop():!1;g&&(c=function(a,b){d.nextTick(function(){g(a,b)})});var h=new e(function(c,d){var e;try{b.push(function(a,b){a?d(a):c(b)}),e=a.apply(f,b),e&&"function"==typeof e.then&&c(e)}catch(g){d(g)}});return c&&h.then(function(a){c(null,a)},c),h.cancel=function(){return this},h})}var d=a("__browserify_process"),e=a("pouchdb-promise");console.log("Promise",e);var f=a("argsarray");b.exports=c},{__browserify_process:3,argsarray:1,"pouchdb-promise":6}],6:[function(a,b){var c="undefined"!=typeof self?self:"undefined"!=typeof window?window:{};b.exports="function"==typeof c.Promise?c.Promise:a("bluebird")},{bluebird:10}],7:[function(a,b){"use strict";function c(){}b.exports=c},{}],8:[function(a,b){"use strict";var c=a("./promise"),d=a("./reject"),e=a("./resolve"),f=a("./INTERNAL"),g=a("./handlers"),h=d(new TypeError("must be an array"));b.exports=function(a){function b(a,b){function c(a){i[b]=a,++j===d&&g.resolve(l,i)}e(a).then(c,function(a){g.reject(l,a)})}if("[object Array]"!==Object.prototype.toString.call(a))return h;var d=a.length;if(!d)return e([]);for(var i=new Array(d),j=0,k=-1,l=new c(f);++k<d;)b(a[k],k);return l}},{"./INTERNAL":7,"./handlers":9,"./promise":11,"./reject":13,"./resolve":14}],9:[function(a,b,c){"use strict";function d(a){var b=a&&a.then;return a&&"object"==typeof a&&"function"==typeof b?function(){b.apply(a,arguments)}:void 0}var e=a("./tryCatch"),f=a("./resolveThenable"),g=a("./states");c.resolve=function(a,b){var h=e(d,b);if("error"===h.status)return c.reject(a,h.value);var i=h.value;if(i)f.safely(a,i);else{a.state=g.FULFILLED,a.outcome=b;for(var j=-1,k=a.queue.length;++j<k;)a.queue[j].callFulfilled(b)}return a},c.reject=function(a,b){a.state=g.REJECTED,a.outcome=b;for(var c=-1,d=a.queue.length;++c<d;)a.queue[c].callRejected(b);return a}},{"./resolveThenable":15,"./states":16,"./tryCatch":17}],10:[function(a,b,c){b.exports=c=a("./promise"),c.resolve=a("./resolve"),c.reject=a("./reject"),c.all=a("./all")},{"./all":8,"./promise":11,"./reject":13,"./resolve":14}],11:[function(a,b){"use strict";function c(a){if(!(this instanceof c))return new c(a);if("function"!=typeof a)throw new TypeError("reslover must be a function");this.state=g.PENDING,this.queue=[],this.outcome=void 0,a!==e&&f.safely(this,a)}var d=a("./unwrap"),e=a("./INTERNAL"),f=a("./resolveThenable"),g=a("./states"),h=a("./queueItem");b.exports=c,c.prototype["catch"]=function(a){return this.then(null,a)},c.prototype.then=function(a,b){if("function"!=typeof a&&this.state===g.FULFILLED||"function"!=typeof b&&this.state===g.REJECTED)return this;var f=new c(e);if(this.state!==g.PENDING){var i=this.state===g.FULFILLED?a:b;d(f,i,this.outcome)}else this.queue.push(new h(f,a,b));return f}},{"./INTERNAL":7,"./queueItem":12,"./resolveThenable":15,"./states":16,"./unwrap":18}],12:[function(a,b){"use strict";function c(a,b,c){this.promise=a,"function"==typeof b&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),"function"==typeof c&&(this.onRejected=c,this.callRejected=this.otherCallRejected)}var d=a("./handlers"),e=a("./unwrap");b.exports=c,c.prototype.callFulfilled=function(a){d.resolve(this.promise,a)},c.prototype.otherCallFulfilled=function(a){e(this.promise,this.onFulfilled,a)},c.prototype.callRejected=function(a){d.reject(this.promise,a)},c.prototype.otherCallRejected=function(a){e(this.promise,this.onRejected,a)}},{"./handlers":9,"./unwrap":18}],13:[function(a,b){"use strict";function c(a){var b=new d(e);return f.reject(b,a)}var d=a("./promise"),e=a("./INTERNAL"),f=a("./handlers");b.exports=c},{"./INTERNAL":7,"./handlers":9,"./promise":11}],14:[function(a,b){"use strict";function c(a){if(a)return a instanceof d?a:f.resolve(new d(e),a);var b=typeof a;switch(b){case"boolean":return g;case"undefined":return i;case"object":return h;case"number":return j;case"string":return k}}var d=a("./promise"),e=a("./INTERNAL"),f=a("./handlers");b.exports=c;var g=f.resolve(new d(e),!1),h=f.resolve(new d(e),null),i=f.resolve(new d(e),void 0),j=f.resolve(new d(e),0),k=f.resolve(new d(e),"")},{"./INTERNAL":7,"./handlers":9,"./promise":11}],15:[function(a,b,c){"use strict";function d(a,b){function c(b){h||(h=!0,e.reject(a,b))}function d(b){h||(h=!0,e.resolve(a,b))}function g(){b(d,c)}var h=!1,i=f(g);"error"===i.status&&c(i.value)}var e=a("./handlers"),f=a("./tryCatch");c.safely=d},{"./handlers":9,"./tryCatch":17}],16:[function(a,b,c){c.REJECTED=["REJECTED"],c.FULFILLED=["FULFILLED"],c.PENDING=["PENDING"]},{}],17:[function(a,b){"use strict";function c(a,b){var c={};try{c.value=a(b),c.status="success"}catch(d){c.status="error",c.value=d}return c}b.exports=c},{}],18:[function(a,b){"use strict";function c(a,b,c){d(function(){var d;try{d=b(c)}catch(f){return e.reject(a,f)}d===a?e.reject(a,new TypeError("Cannot resolve promise with itself")):e.resolve(a,d)})}var d=a("immediate"),e=a("./handlers");b.exports=c},{"./handlers":9,immediate:19}],19:[function(a,b){"use strict";function c(){e=!0;for(var a,b,c=h.length;c;){for(b=h,h=[],a=-1;++a<c;)b[a]();c=h.length}e=!1}function d(a){1!==h.push(a)||e||f()}for(var e,f,g=[a("./nextTick"),a("./mutation.js"),a("./messageChannel"),a("./stateChange"),a("./timeout")],h=[],i=-1,j=g.length;++i<j;)if(g[i]&&g[i].test&&g[i].test()){f=g[i].install(c);break}b.exports=d},{"./messageChannel":20,"./mutation.js":21,"./nextTick":2,"./stateChange":22,"./timeout":23}],20:[function(a,b,c){var d="undefined"!=typeof self?self:"undefined"!=typeof window?window:{};c.test=function(){return d.setImmediate?!1:"undefined"!=typeof d.MessageChannel},c.install=function(a){var b=new d.MessageChannel;return b.port1.onmessage=a,function(){b.port2.postMessage(0)}}},{}],21:[function(a,b,c){var d="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e=d.MutationObserver||d.WebKitMutationObserver;c.test=function(){return e},c.install=function(a){var b=0,c=new e(a),f=d.document.createTextNode("");return c.observe(f,{characterData:!0}),function(){f.data=b=++b%2}}},{}],22:[function(a,b,c){var d="undefined"!=typeof self?self:"undefined"!=typeof window?window:{};c.test=function(){return"document"in d&&"onreadystatechange"in d.document.createElement("script")},c.install=function(a){return function(){var b=d.document.createElement("script");return b.onreadystatechange=function(){a(),b.onreadystatechange=null,b.parentNode.removeChild(b),b=null},d.document.documentElement.appendChild(b),a}}},{}],23:[function(a,b,c){"use strict";c.test=function(){return!0},c.install=function(a){return function(){setTimeout(a,0)}}},{}],24:[function(a,b){function c(a){var b=this;if(!(b instanceof c))throw new Error("usage: new Hoodie(url);");b.baseUrl=a?a.replace(/\/+$/,""):"",b.checkConnectionInterval=3e3,b.API_PATH="/_api",b.extend=function(a){a(b,o,p)},b.extend(n),b.extend(h),b.extend(l),b.extend(j),b.extend(k),b.extend(f),b.extend(g),b.extend(i),b.extend(m),b.on("account:cleanup",p.config.clear),b.id.init(),b.account.username=p.config.get("_account.username"),b.remote.init(),b.account.checkPasswordReset(),b.store.bootstrapDirtyObjects(),b.account.subscribeToOutsideEvents(),b.id.subscribeToOutsideEvents(),b.store.subscribeToOutsideEvents(),b.remote.subscribeToOutsideEvents(),b.task.subscribeToOutsideEvents(),b.account.authenticate().then(function(){b.remote.connect()}),e.addEventListener("online",b.checkConnection,!1),e.addEventListener("offline",b.checkConnection,!1),b.checkConnection(),d(b)}function d(a){for(var b=0;b<q.length;b++)q[b](a,o,p)}var e="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},f=a("./hoodie/account"),g=a("./hoodie/remote"),h=a("./hoodie/connection"),i=a("./hoodie/id"),j=a("./hoodie/store"),k=a("./hoodie/task"),l=a("./hoodie/open"),m=a("./hoodie/request"),n=a("./lib/events"),o=a("./lib"),p=a("./utils/"),q=[];c.extend=function(a){q.push(a)},b.exports=c},{"./hoodie/account":25,"./hoodie/connection":26,"./hoodie/id":27,"./hoodie/open":28,"./hoodie/remote":29,"./hoodie/request":30,"./hoodie/store":31,"./hoodie/task":32,"./lib":38,"./lib/events":37,"./utils/":48}],25:[function(a,b){var c="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},d=a("../lib/events"),e=a("extend"),f=a("../utils/generate_id"),g=a("../utils/config"),h=a("../utils/"),i=a("../utils/promise/");b.exports=function(a){function b(a){return g.set(W,a)}function j(){return g.get(W)}function k(){return g.unset(W)}function l(){var b=a.id(),c=j();return S.signIn(b,c).done(function(){S.trigger("signin:anonymous",b)})}function m(){a.on("remote:error:unauthenticated",n)}function n(){return R=void 0,S.authenticate()}function o(a){return S.username!==a?(S.username=a,g.set("_account.username",a)):void 0}function p(a){return a.userCtx.name?(R=!0,i.resolveWith(S.username)):S.hasAnonymousAccount()?l():(R=!1,S.trigger("error:unauthenticated"),i.reject())}function q(a,b){return function(c){return T._rev=c.rev,s(a,b)}}function r(a){return function(b){return"HoodieConflictError"===b.name&&(b.message="Username "+a+" already exists"),i.rejectWith(b)}}function s(a,b,d,e){return e||(e=i.defer()),c.setTimeout(function(){var c=P(a,b,d);c.done(c.defer.resolve),c.fail(function(f){"HoodieAccountUnconfirmedError"===f.name?s(a,b,d,e):c.defer.reject.apply(e,arguments)})},300),i.defer.promise()}function t(a){return a=a||{},function(b){var c,d;return c=b.name.replace(/^user(_anonymous)?\//,""),d=b.roles[0],-1!==b.roles.indexOf("error")?S.fetch(c).then(function(){return i.rejectWith(T.$error)}):-1===b.roles.indexOf("confirmed")?i.rejectWith({name:"HoodieAccountUnconfirmedError",message:"Account has not been confirmed yet"}):(R=!0,S.fetch(),i.resolveWith(c,d,a))}}function u(a){var b;return a.$error?(b=a.$error,b.object=a,delete b.object.$error):b={name:"HoodiePendingError",message:"Password reset is still pending"},i.rejectWith(b)}function v(a){return function(b){return"HoodieUnauthorizedError"===b.name?(g.unset("_account.resetPasswordId"),S.trigger("passwordreset",a),i.resolve()):i.rejectWith(b)}}function w(){var a=i.defer();return S.one("passwordreset",i.defer.resolve),S.on("error:passwordreset",x),S.on("error:passwordreset",i.defer.reject),a.always(function(){S.unbind("passwordreset",i.defer.resolve),S.unbind("error:passwordreset",x),S.unbind("error:passwordreset",i.defer.reject)}),i.defer.promise()}function x(a){var b=a.object,c=b.name,d=c.substr(15),e="/_users/"+encodeURIComponent(V+":"+c),f=btoa(c+":"+d);b._deleted=!0;var h={headers:{Authorization:"Basic "+f},contentType:"application/json",data:JSON.stringify(b)};S.request("PUT",e,h),g.unset("_account.resetPasswordId")}function y(b,c,d){var e=S.hasAnonymousAccount()?a.id():S.username;return P(e,b).then(function(){return S.fetch().then(I(b,c,d))})}function z(a,b){var c=j();return y(c,a,b).done(function(){S.trigger("signup",a),k()})}function A(){return D(),T._deleted=!0,L("updateUsersDoc",function(){S.request("PUT",H(),{data:JSON.stringify(T),contentType:"application/json"})})}function B(a){return"HoodieNotFoundError"===a.name?i.resolve():i.rejectWith(a)}function C(){return S.trigger("cleanup"),R=void 0,o(void 0),i.resolve()}function D(){return a.remote.disconnect()}function E(){var a=S.username;return C().then(function(){return S.trigger("signout",a)})}function F(b){var c;return c=b===a.id()?"user_anonymous":"user",""+c+"/"+b}function G(b){var c=S.hasAnonymousAccount()?a.id():S.username;return b=b||c,""+V+":"+F(b)}function H(a){return"/_users/"+encodeURIComponent(G(a))}function I(a,b,c){return function(){var d=e({},T);b&&(d.$newUsername=b),d.updatedAt=h.now(),d.signedUpAt=d.signedUpAt||h.now(),void 0!==c&&(delete d.salt,delete d.password_sha,d.password=c);var f={data:JSON.stringify(d),contentType:"application/json"};return L("updateUsersDoc",function(){return S.request("PUT",H(),f).then(J(b,c||a))})}}function J(b,c){var d=S.hasAnonymousAccount()?a.id():S.username;return function(){return D(),b?K(d,c).then(function(){return S.signOut({silent:!0,ignoreLocalChanges:!0}).then(function(){return S.signIn(b,c,{moveData:!0})})}):S.signIn(d,c)}}function K(a,b,d){d||(d=i.defer());var e={data:{name:F(a),password:b}};return L("signIn",function(){return S.request("POST","/_session",e)}).done(function(){c.setTimeout(K,300,a,b,d)}).fail(function(a){return 401===a.status?i.defer.resolve():void i.defer.reject(a)}),i.defer.promise()}function L(a,b){return void 0!==U[a]&&"function"==typeof U[a].abort&&U[a].abort(),U[a]=b(),U[a]}function M(a,b){return void 0!==U[a]&&"function"==typeof U[a].state&&"pending"===U[a].state()?U[a]:(U[a]=b(),U[a])}function N(b){return a.store.hasLocalChanges()&&!b.ignoreLocalChanges?a.remote.push():i.resolve()}function O(){return M("signOut",function(){return S.request("DELETE","/_session")})}function P(a,b,c){var d={data:{name:F(a),password:b}};return L("signIn",function(){var a=S.request("POST","/_session",d);return a.then(t(c))})}function Q(b,c){var d;return b=b.toLowerCase(),d={data:JSON.stringify({_id:G(b),name:F(b),type:"user",roles:[],password:c,hoodieId:a.id(),database:S.db(),updatedAt:h.now(),createdAt:h.now(),signedUpAt:b!==a.id()?h.now():void 0}),contentType:"application/json"},S.request("PUT",H(b),d).done(i.defer.notify).then(q(b,c),r(b)).then(i.defer.resolve,i.defer.reject),i.defer.promise()}var R,S={},T={},U={},V="org.couchdb.user";d(a,{context:S,namespace:"account"}),S.authenticate=function(){var a;return R===!1?i.reject():R===!0?i.resolveWith(S.username):U.signOut&&"pending"===U.signOut.state()?U.signOut.then(i.reject):U.signIn&&"pending"===U.signIn.state()?U.signIn:S.hasAccount()?(a=function(){return S.request("GET","/_session").then(p)},M("authenticate",a)):O().then(function(){return R=!1,i.reject()})},S.hasValidSession=function(){return S.hasAccount()?R===!0:!1},S.hasInvalidSession=function(){return S.hasAccount()?R===!1:!1},S.signUp=function(a,b){return void 0===b&&(b=""),a?S.hasAnonymousAccount()?z(a,b):S.hasAccount()?i.rejectWith("Must sign out first."):Q(a,b).done(function(){o(a),S.trigger("signup",a)}):i.rejectWith("Username must be set.")},S.anonymousSignUp=function(){var c,d;return c=f(10),d=a.id(),Q(d,c).progress(function(){b(c)}).done(function(){S.trigger("signup:anonymous")})},S.hasAccount=function(){return!!S.username||S.hasAnonymousAccount()},S.hasAnonymousAccount=function(){return!!j()};var W="_account.anonymousPassword";S.signIn=function(a,b,c){var d,e,f=a===S.username;return a||(a=""),b||(b=""),a=a.toLowerCase(),c=c||{},d=c.silent,e=!S.hasAccount()||f||c.moveData?P(a,b,c):N(c).then(function(){return P(a,b,c)}),f||e.done(D),e.done(function(a,b){c.moveData&&(d||S.trigger("movedata")),f||C(),f?d||S.trigger("reauthenticated",a):o(a),d||S.trigger("signin",a,b,c)})},S.signOut=function(a){var b;return a=a||{},b=a.silent?C:E,S.hasAccount()?N(a).then(D).then(O).then(b):b()},S.request=function(b,c,d){return d=d||{},a.request.apply(a,arguments)},S.db=function(){return"user/"+a.id()},S.fetch=function(b){var c=S.hasAnonymousAccount()?a.id():S.username;return void 0===b&&(b=c),b?M("fetch",function(){return S.request("GET",H(b)).done(function(a){return T=a})}):i.rejectWith({name:"HoodieUnauthorizedError",message:"Not signed in"})},S.changePassword=function(a,b){return S.username?(D(),S.fetch().then(I(a,null,b)).done(function(){S.trigger("changepassword")})):i.rejectWith({name:"HoodieUnauthorizedError",message:"Not signed in"})},S.resetPassword=function(a){var b,c,d,e;return(e=g.get("_account.resetPasswordId"))?S.checkPasswordReset():(e=""+a+"/"+f(),g.set("_account.resetPasswordId",e),c=""+V+":$passwordReset/"+e,b={_id:c,name:"$passwordReset/"+e,type:"user",roles:[],password:e,createdAt:h.now(),updatedAt:h.now()},d={data:JSON.stringify(b),contentType:"application/json"},L("resetPassword",function(){return S.request("PUT","/_users/"+encodeURIComponent(c),d).done(S.checkPasswordReset).then(w).done(function(){S.trigger("resetpassword")})}))},S.checkPasswordReset=function(){var a,b,d,e,f,h;return(d=g.get("_account.resetPasswordId"))?(f=d.split("/")[0],h="$passwordReset/"+d,e="/_users/"+encodeURIComponent(V+":"+h),a=btoa(h+":"+d),b={headers:{Authorization:"Basic "+a}},M("passwordResetStatus",function(){return S.request("GET",e,b).then(u,v(f)).fail(function(a){return"HoodiePendingError"===a.name?void c.setTimeout(S.checkPasswordReset,1e3):S.trigger("error:passwordreset",a,f)})})):i.rejectWith("No pending password reset.")},S.changeUsername=function(b,c){var d=S.hasAnonymousAccount()?a.id():S.username;return c!==d?(c=c||"",y(b,c.toLowerCase()).done(function(){o(c),S.trigger("changeusername",c)})):i.rejectWith({name:"HoodieConflictError",message:"Usernames identical"})},S.destroy=function(){return S.hasAccount()?S.fetch().then(A,B).then(E):E()},S.subscribeToOutsideEvents=function(){m(),delete S.subscribeToOutsideEvents},a.account=S}},{"../lib/events":37,"../utils/":48,"../utils/config":45,"../utils/generate_id":46,"../utils/promise/":50,extend:4}],26:[function(a,b,c){var d="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e=a("../utils/");b.exports=function(a){var b=!0,f=null,g=null;a.checkConnection=function(){var b=f,e="/?hoodieId="+a.id();return b&&"pending"===b.state()?b:(d.clearTimeout(g),f=a.request("GET",e).then(c.handleCheckConnectionSuccess,c.handleCheckConnectionError))},a.isConnected=function(){return b},c.handleCheckConnectionSuccess=e.toPromise(function(c){return a.checkConnectionInterval=3e4,g=d.setTimeout(a.checkConnection,a.checkConnectionInterval),a.isConnected()||(a.trigger("reconnected"),b=!0),c(null)}),c.handleCheckConnectionError=e.toPromise(function(c){return a.checkConnectionInterval=3e3,g=d.setTimeout(a.checkConnection,a.checkConnectionInterval),a.isConnected()&&(a.trigger("disconnected"),b=!1),c(null)})}},{"../utils/":48}],27:[function(a,b){var c=a("../utils/generate_id"),d=a("../utils/config");b.exports=function(a){function b(){return i||e(c()),i}function e(a){i=a,d.set("_hoodieId",a)}function f(){i=void 0,d.unset("_hoodieId")}function g(){i=d.get("_hoodieId"),i||(i=d.get("_account.ownerHash"))}function h(){a.on("account:cleanup",f),a.on("account:signin",function(a,b){e(b)}),a.on("account:signin:anonymous",e)}var i;b.init=function(){g(),delete b.init},b.subscribeToOutsideEvents=function(){h(),delete b.subscribeToOutsideEvents},a.id=b}},{"../utils/config":45,"../utils/generate_id":46}],28:[function(a,b){var c=a("../lib/store/remote"),d=a("extend");b.exports=function(a){a.open=function(b,e){return e=e||{},d(e,{name:b}),c(a,e)}}},{"../lib/store/remote":41,extend:4}],29:[function(a,b){function c(a){function b(a){return a?d.set("_remote.since",a):d.get("_remote.since")||0}function c(){a.on("remote:connect",function(){a.on("store:idle",f.push)}),a.on("remote:disconnect",function(){a.unbind("store:idle",f.push)}),a.on("disconnected",f.disconnect),a.on("reconnected",f.connect),a.on("account:signup",f.connect),a.on("account:signup:anonymous",f.connect),a.on("account:signin",f.connect),a.on("account:signin:anonymous",f.connect),a.on("account:reauthenticated",f.connect),a.on("account:signout",f.disconnect)}var f=a.open(a.account.db(),{connected:!0,prefix:"",since:b,defaultObjectsToPush:a.store.changedObjects,knownObjects:a.store.index().map(function(a){var b=a.split(/\//);return{type:b[0],id:b[1]}})}),g=f.connect;f.connect=e.toPromise(function(b){return a.account.hasAccount()?g(a.account.db()):b(new Error("User has no database to connect to"))}),f.trigger=function(){var b;b=arguments[0];var c=2<=arguments.length?Array.prototype.slice.call(arguments,1):[];return a.trigger.apply(a,["remote:"+b].concat(Array.prototype.slice.call(c)))},f.on=function(b,c){return b=b.replace(/(^| )([^ ]+)/g,"$1remote:$2"),a.on(b,c)},f.unbind=function(b,c){return b=b.replace(/(^| )([^ ]+)/g,"$1remote:$2"),a.unbind(b,c)},f.subscribeToOutsideEvents=function(){c(),delete f.subscribeToOutsideEvents},a.remote=f}var d=a("../utils/config"),e=a("../utils/");b.exports=function(a){var b=function(){c(a)};a.remote={init:b}}},{"../utils/":48,"../utils/config":45}],30:[function(a,b){var c=a("../utils/hoodiefy_request_error_name"),d=a("extend"),e=a("../utils/promise/");b.exports=function(a){function b(b,c,e){var g,j,k;return e=e||{},g={type:b,dataType:"json"},/^http/.test(c)||(c=(a.baseUrl||"")+i+c),/^http/.test(c)&&(g.xhrFields={withCredentials:!0},g.crossDomain=!0),g.url=c,j=h(d(g,e)),k=j.then(null,f),k.abort=j.abort,k}function f(b){var c;try{c=g(b)}catch(d){c=b.responseText?b.responseText:{name:"HoodieConnectionError",message:"Could not connect to Hoodie server at {{url}}.",url:a.baseUrl||"/"}}return e.rejectWith(c).promise()}function g(a){var b=JSON.parse(a.responseText);return b.name=j[a.status],b.name||(b.name=c(b.error)),b.status=a.status,b.message=b.reason||"",b.message=b.message.charAt(0).toUpperCase()+b.message.slice(1),delete b.error,delete b.reason,b}var h=$.ajax,i=a.API_PATH,j={400:"HoodieRequestError",401:"HoodieUnauthorizedError",403:"HoodieRequestError",404:"HoodieNotFoundError",409:"HoodieConflictError",412:"HoodieConflictError",500:"HoodieServerError"};a.request=b}},{"../utils/hoodiefy_request_error_name":47,"../utils/promise/":50,extend:4}],31:[function(a,b,c){var d="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e=a("../lib/store/api"),f=a("../lib/error/object_type"),g=a("../lib/error/object_id"),h=a("../utils/generate_id"),i=a("../utils/config"),j=a("extend"),k=a("../utils/"),l=a("../utils/local_storage_wrapper");b.exports=function(a){function b(a){if(f.isInvalid(a.type))return new f({type:a.type});if(a.id)return g.isInvalid(a.id)?new g({id:a.id}):void 0}function m(a,b,c,d){var e,f;if(void 0===c&&(c=!1),d=d||{},e=""+a+"/"+b,c){if(j(c,{type:a,id:b}),f=j({},c),delete f.type,delete f.id,l.setObject(e,f),d.remote)return q(a,b),G[e]=j(!0,{},c),G[e]}else{if(G[e]===!1)return!1;if(G[e])return j(!0,{},G[e]);if(e=""+a+"/"+b,c=l.getObject(e),!c)return q(a,b),G[e]=!1,!1;c.type=a,c.id=b}return y(c)?(p(a,b,c,d),G[e]=!1,!1):(G[e]=j(!0,{},c),x(c)?p(a,b,G[e],d):q(a,b),j(!0,{},c))}function n(){var a,b,c,d,e,f,g;if(b=l.getItem("_dirty"))for(b=b.split(","),e=0,f=b.length;f>e;e++)g=b[e].split("/"),d=g[0],a=g[1],c=m(d,a)}function o(){a.on("account:signup",r),a.on("account:movedata",E),a.on("account:cleanup",K.clear),a.on("remote:bootstrap:start",B),a.on("remote:bootstrap:end",C),a.on("remote:bootstrap:error",D),a.on("remote:change",s),a.on("remote:push",t)}function p(a,b,c,d){var e;d=d||{},e=""+a+"/"+b,H[e]=c,u(),d.silent||A()}function q(a,b){var c;return a&&b?(c=""+a+"/"+b,delete H[c]):H={},u(),d.clearTimeout(M)}function r(){return K.findAll().pipe(function(a){var b,c,d,e;for(d=0,e=a.length;e>d;d++)c=a[d],b=""+c.type+"/"+c.id,H[b]=c;u(),A()})}function s(a,b){"remove"===a?K.remove(b.type,b.id,{remote:!0,update:b}):K.save(b.type,b.id,b,{remote:!0})}function t(a){z("sync",a),a._deleted?K.remove(a.type,a.id,{remote:!0,silent:!0}):K.save(a.type,a.id,a,{remote:!0,silent:!0})}function u(){try{if($.isEmptyObject(H))l.removeItem("_dirty");else{var a=Object.keys(H);l.setItem("_dirty",a.join(","))}}catch(b){}}function v(){return JSON.stringify(new Date).replace(/['"]/g,"")}function w(a){return N.test(a)}function x(a){return a.updatedAt?a._syncedAt?a._syncedAt<a.updatedAt:!0:!1}function y(a){return a._deleted===!0}function z(a,b,c){K.trigger(a,j(!0,{},b),c),K.trigger(b.type+":"+a,j(!0,{},b),c),K.trigger(a+":"+b.type,j(!0,{},b),c),"new"!==a&&(K.trigger(b.type+":"+b.id+":"+a,j(!0,{},b),c),K.trigger(a+":"+b.type+":"+b.id,j(!0,{},b),c)),"sync"!==a&&(K.trigger("change",a,j(!0,{},b),c),K.trigger(b.type+":change",a,j(!0,{},b),c),K.trigger("change:"+b.type,a,j(!0,{},b),c),"new"!==a&&(K.trigger(b.type+":"+b.id+":change",a,j(!0,{},b),c),K.trigger("change:"+b.type+":"+b.id,a,j(!0,{},b),c)))}function A(){K.trigger("dirty"),d.clearTimeout(M),M=d.setTimeout(function(){K.trigger("idle",K.changedObjects())},J)}function B(){L=!0,K.trigger("bootstrap:start")}function C(){var a,b,c,d;for(L=!1;I.length>0;)a=I.shift(),b=a[0],c=a[1],d=a[2],F[b].apply(F,c).then(d.resolve,d.reject);K.trigger("bootstrap:end")}function D(a){var b,c;for(L=!1;I.length>0;)b=I.shift(),c=b[2],c.reject(a);K.trigger("bootstrap:error",a)}function E(){var b,c,d=[];K.findAll().done(function(e){d=e,c=a.id(),b=i.get(),a.one("signin",function(a,e){for(var f in b)b.hasOwnProperty(f)&&"_account.username"!==f&&"_hoodieId"!==f&&i.set(f,b[f]);d.forEach(function(a){a.createdBy===c&&(a.createdBy=e),K.add(a.type,a)})})})}var F={},G={},H={},I=[],J=2e3;F.save=k.toPromise(function(b,d,e){var f,g,i,j;if(d=d||{},K.isBootstrapping()&&!d.remote)return c.enqueue("save",arguments);if(b.id?(f=m(b.type,b.id),i="object"!=typeof f):(i=!0,b.id=h()),i?b.createdBy=b.createdBy||a.id():f.createdBy&&(b.createdBy=f.createdBy),!i)for(j in f)if(!b.hasOwnProperty(j))switch(j.charAt(0)){case"_":d.remote&&(b[j]=f[j]);break;case"$":d.remote||(b[j]=f[j])}d.remote?b._syncedAt=v():d.silent||(b.updatedAt=v(),b.createdAt=b.createdAt||b.updatedAt),d.local?b._$local=!0:delete b._$local;try{b=m(b.type,b.id,b,d),g=i?"add":"update",e(null,b,i),d.silent||z(g,b,d)}catch(k){return e(k,null)}}),F.find=k.toPromise(function(a,b,d){var e;if(K.isBootstrapping())return c.enqueue("find",arguments);try{return e=m(a,b),e?d(null,e):d({name:"HoodieNotFoundError",message:'"{{type}}" with id "{{id}}" could not be found'},null)}catch(f){return d(f,null)}}),F.findAll=k.toPromise(function(a,b){var d,e,f,g,h,i,j;if(null==a&&(a=function(){return!0}),K.isBootstrapping())return c.enqueue("findAll",arguments);g=K.index(),"string"==typeof a&&(j=a,a=function(a){return a.type===j});try{return i=function(){var b,c,i,j;for(j=[],b=0,c=g.length;c>b;b++)f=g[b],w(f)&&(i=f.split("/"),d=i[0],e=i[1],h=m(d,e),h&&a(h)&&j.push(h));return j}.call(this),i.sort(function(a,b){return a.createdAt>b.createdAt?-1:a.createdAt<b.createdAt?1:0}),b(null,i)}catch(k){return b(k,null)}}),F.remove=k.toPromise(function(a,b,d,e){var f,g,h;return d=d||{},K.isBootstrapping()&&!d.remote?c.enqueue("remove",arguments):(f=a+"/"+b,g=m(a,b),d.remote&&(l.removeItem(f),h=G[f]&&y(G[f]),G[f]=!1,q(a,b),h&&g)?e(null,g):g?(g._syncedAt?(g._deleted=!0,m(a,b,g)):(f=a+"/"+b,l.removeItem(f),G[f]=!1,q(a,b)),d.update&&(g=d.update,delete d.update),z("remove",g,d),e(g)):e({name:"HoodieNotFoundError",message:'"{{type}}" with id "{{id}}"" could not be found'},null))}),F.removeAll=k.toPromise(function(a,b,c){return K.findAll(a).then(function(a){var d,e,f,g;for(g=[],e=0,f=a.length;f>e;e++)d=a[e],g.push(K.remove(d.type,d.id,b));return c(null,g)})});var K=e(a,{validate:b,backend:{save:F.save,find:F.find,findAll:F.findAll,remove:F.remove,removeAll:F.removeAll}});K.index=function(){var a,b,c,d,e;for(c=[],a=d=0,e=l.length();e>=0?e>d:d>e;a=e>=0?++d:--d)b=l.key(a),w(b)&&c.push(b);return c},K.changedObjects=function(){var a,b,c,d,e,f,g;e=H,g=[];for(b in e)e.hasOwnProperty(b)&&(c=e[b],f=b.split("/"),d=f[0],a=f[1],c.type=d,c.id=a,g.push(c));return g},K.hasLocalChanges=function(a,b){if(!a)return!$.isEmptyObject(H);var c=[a,b].join("/");return H[c]?!0:x(m(a,b))},K.clear=k.toPromise(function(a){var b,c,d;try{return c=K.index(),d=function(){var a,d,e;for(e=[],a=0,d=c.length;d>a;a++)b=c[a],w(b)&&e.push(l.removeItem(b));return e}.call(this),G={},q(),K.trigger("clear"),a(null)}catch(e){return a(e,null)}});var L=!1;K.isBootstrapping=function(){return L},K.isPersistent=function(){return l.isPersistent},K.subscribeToOutsideEvents=function(){o(),delete K.subscribeToOutsideEvents};var M,N=new RegExp(/^[a-z$][a-z0-9]+\/[a-z0-9]+$/);c.enqueue=k.toPromise(function(a,b,c){return I.push([a,b]),c(null)}),a.store=K,K.bootstrapDirtyObjects=function(){n(),delete K.bootstrapDirtyObjects}}},{"../lib/error/object_id":35,"../lib/error/object_type":36,"../lib/store/api":39,"../utils/":48,"../utils/config":45,"../utils/generate_id":46,"../utils/local_storage_wrapper":49,extend:4}],32:[function(a,b,c){var d=a("../lib/events"),e=a("../lib/task/scoped"),f=a("../lib/error/error"),g=a("extend"),h=a("../utils/");b.exports=function(a){function b(){a.on("store:change",i)}function i(a,b,c){"$"===b.type[0]&&(b.type=b.type.substr(1),m(a,b,c))}function j(b){var c,d="$";return b&&(d+=b),c=function(a){return 0===a.type.indexOf(d)},a.store.findAll(c)}function k(a){return a.map(function(a){return n.abort(a.type.substr(1),a.id)})}function l(a,b){return a.map(function(a){return n.restart(a.type.substr(1),a.id,b)})}function m(a,b,c){var d;return"add"===a&&(a="start"),"remove"===a&&b.abortedAt&&(a="abort"),"remove"===a&&b.$processedAt&&!b.$error&&(a="success"),"update"===a&&b.$error?(a="error",d=b.$error,delete b.$error,n.trigger("error",d,b,c),n.trigger(b.type+":error",d,b,c),n.trigger(b.type+":"+b.id+":error",d,b,c),c=g({},c,{error:d}),n.trigger("change","error",b,c),n.trigger(b.type+":change","error",b,c),void n.trigger(b.type+":"+b.id+":change","error",b,c)):void(("start"===a||"abort"===a||"success"===a)&&(n.trigger(a,b,c),n.trigger(b.type+":"+a,b,c),"start"!==a&&n.trigger(b.type+":"+b.id+":"+a,b,c),n.trigger("change",a,b,c),n.trigger(b.type+":change",a,b,c),"start"!==a&&n.trigger(b.type+":"+b.id+":change",a,b,c)))}var n=function o(b,c){return e(a,o,{type:b,id:c})};d(a,{context:n,namespace:"task"}),n.start=function(b,d){return a.account.hasAccount()?a.store.add("$"+b,d).then(c.handleNewTask):a.account.anonymousSignUp().then(function(){return n.start(b,d)})},n.abort=function(b,d){return a.store.update("$"+b,d,{abortedAt:h.nowStringified()}).then(c.handleAbortedTaskObject)},n.restart=function(a,b,c){var d=function(a){return g(a,c),delete a.$error,delete a.$processedAt,delete a.abortedAt,n.start(a.type,a)};return n.abort(a,b).then(d)},n.abortAll=function(a){return j(a).then(k)},n.restartAll=function(a,b){return"object"==typeof a&&(b=a),j(a).then(function(a){l(a,b)})},n.subscribeToOutsideEvents=function(){b(),delete n.subscribeToOutsideEvents
},c.handleNewTask=h.toPromise(function(b,c){var d=a.store(b.type,b.id);return d.on("remove",function(a){return a.type=a.type.substr(1),a.$processedAt?c(null,a):void c(new f({message:"Task has been aborted",task:a}),null)}),d.on("update",function(b){var d=b.$error;if(b.$error)return b.type=b.type.substr(1),delete b.$error,d.object=b,d.message=d.message||"Something went wrong",a.store.remove("$"+b.type,b.id),c(new f(d),null)}),c(null)}),c.handleAbortedTaskObject=h.toPromise(function(b,c){var d=b.type,e=b.id,f=a.store.remove(d,e);return b._rev?(a.one("store:sync:"+d+":"+e,c(null)),f.fail(c),c(null)):f}),a.task=n}},{"../lib/error/error":33,"../lib/events":37,"../lib/task/scoped":44,"../utils/":48,extend:4}],33:[function(a,b){var c=/\{\{\s*\w+\s*\}\}/g,d=/\w+/,e=a("extend");b.exports=f;var f=function(a){"string"==typeof a&&(a={message:a}),a.message||(a.message="Something went wrong"),a.name||(a.name="HoodieError"),a.message=a.message.replace(c,function(b){var c=b.match(d)[0];return a[c]}),e(this,a)};f.prototype=new Error,f.prototype.constructor=f},{extend:4}],34:[function(a,b){b.exports={error:a("./error"),objectId:a("./object_id"),objectType:a("./object_type")}},{"./error":33,"./object_id":35,"./object_type":36}],35:[function(a,b){function c(a){return a.name="HoodieObjectIdError",a.message='"{{id}}" is invalid object id. {{rules}}.',new d(a)}var d=a("./error"),e=/^[a-z0-9\-]+$/;c.isInvalid=function(a,b){return!(b||e).test(a||"")},c.isValid=function(a,b){return(b||e).test(a||"")},c.prototype.rules="Lowercase letters, numbers and dashes allowed only. Must start with a letter",b.exports=c},{"./error":33}],36:[function(a,b){function c(a){return a.name="HoodieObjectTypeError",a.message='"{{type}}" is invalid object type. {{rules}}.',new d(a)}var d=a("./error"),e=/^[a-z$][a-z0-9]+$/;c.isInvalid=function(a,b){return!(b||e).test(a||"")},c.isValid=function(a,b){return(b||e).test(a||"")},c.prototype.rules="lowercase letters, numbers and dashes allowed only. Must start with a letter",b.exports=c},{"./error":33}],37:[function(a,b){b.exports=function(a,b){function c(b,c){var d,e,f,g;for(d=b.split(" "),f=0,g=d.length;g>f;f++)e=h+d[f],a.eventsCallbacks[e]=a.eventsCallbacks[e]||[],a.eventsCallbacks[e].push(c)}function d(b,c){b=h+b;var d=function(){a.unbind(b,d),c.apply(null,arguments)};a.bind(b,d)}function e(){var b,c,d,e,f,g;if(b=1<=arguments.length?Array.prototype.slice.call(arguments,0):[],d=b.shift(),d=h+d,e=a.eventsCallbacks[d]){for(f=0,g=e.length;g>f;f++)c=e[f],c.apply(null,b);return!0}}function f(b,c){var d,e,f,g,i,j;if(!b)return h||(a.eventsCallbacks={}),j=Object.keys(a.eventsCallbacks),j=j.filter(function(a){return 0===a.indexOf(h)}),void j.forEach(function(b){delete a.eventsCallbacks[b]});if(b=h+b,f=a.eventsCallbacks[b]){if(!c)return void delete a.eventsCallbacks[b];for(e=g=0,i=f.length;i>g;e=++g)if(d=f[e],d===c){f=f.slice(),f.splice(e,1),a.eventsCallbacks[b]=f;break}}}var g=a,h="";b=b||{},a.eventsCallbacks||(a.eventsCallbacks={}),b.context&&(g=b.context,h=b.namespace+":"),g.bind=c,g.on=c,g.one=d,g.trigger=e,g.unbind=f,g.off=f}},{}],38:[function(a,b){b.exports={error:a("./error"),events:a("./events"),store:a("./store"),task:a("./task")}},{"./error":34,"./events":37,"./store":40,"./task":43}],39:[function(a,b){var c=a("./scoped"),d=a("../events"),e=a("../error/error"),f=a("../error/object_type"),g=a("../error/object_id"),h=a("extend"),i=a("../../utils/"),j=a("../../utils/promise");b.exports=function(a,b){function k(a){return h(a,m)}var l={},m={hoodie:a},n=b.name||"store",o=function s(d,e){var f=h(!0,{type:d,id:e},b);return c(a,s,f)};if(d(a,{context:o,namespace:n}),o.validate=b.validate,b.validate||(o.validate=function(a){if(!a)return new e({name:"InvalidObjectError",message:"No object passed."});if(f.isInvalid(a.type,q))return new f({type:a.type,rules:r});if(a.id)return g.isInvalid(a.id,q)?new g({id:a.id,rules:r}):void 0}),o.save=i.toPromise(function(a,b,c,d,e){d=d?h(!0,{},d):{};var f=h(!0,{},c,{type:a,id:b}),g=o.validate(f,d||{});return g?e(g):k(l.save(f,d||{}))}),o.add=function(a,b,c){return void 0===b&&(b={}),c=c||{},o.save(a,b.id,b,c)},o.find=function(a,b){return k(l.find(a,b))},o.findOrAdd=function(a,b,c){function d(){var d;return d=h(!0,{id:b},c),o.add(a,d)}null===c&&(c={});var e=o.find(a,b).then(null,d);return k(e)},o.findAll=function(a,b){return k(l.findAll(a,b))},o.update=i.toPromise(function(a,b,c,d,e){function f(f){var g,i,j;return i=h(!0,{},f),"function"==typeof c&&(c=c(i)),c?(g=function(){var a=[];for(var b in c)if(c.hasOwnProperty(b)){if(j=c[b],f[b]===j)continue;i[b]=j,a.push(b)}return a}(),g.length||d?o.save(a,b,i,d):e(i)):e(f)}var g=o.find(a,b).then(f);return k(g)}),o.updateOrAdd=function(a,b,c,d){function e(){var e=h(!0,{},c,{id:b});return o.add(a,e,d)}var f=o.update(a,b,c,d).then(null,e);return k(f)},o.updateAll=i.toPromise(function(a,b,c,d){var e;switch(c=c||{},!0){case"string"==typeof a:e=o.findAll(a);break;case j.isPromise(a):e=a;break;case $.isArray(a):e=d(a);break;default:e=o.findAll()}return e=e.then(function(a){var e,f;return $.isArray(a)||(a=[a]),f=function(){var d,f,g;for(g=[],d=0,f=a.length;f>d;d++)e=a[d],g.push(o.update(e.type,e.id,b,c));return g}(),d(null,f)}),k(e)}),o.remove=function(a,b,c){return k(l.remove(a,b,c||{}))},o.removeAll=function(a,b){return k(l.removeAll(a,b||{}))},o.decoratePromises=function(a){return h(m,a)},!b.backend)throw new Error("options.backend must be passed");var p="save find findAll remove removeAll".split(" ");p.forEach(function(a){if(!b.backend[a])throw new Error("options.backend."+a+" must be passed.");l[a]=b.backend[a]});var q=/^[^\/]+$/,r="/ not allowed";return o}},{"../../utils/":48,"../../utils/promise":50,"../error/error":33,"../error/object_id":35,"../error/object_type":36,"../events":37,"./scoped":42,extend:4}],40:[function(a,b){b.exports={api:a("./api"),remote:a("./remote"),scoped:a("./scoped")}},{"./api":39,"./remote":41,"./scoped":42}],41:[function(a,b){var c="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},d=a("./api"),e=a("extend"),f=a("../../utils/generate_id"),g=a("../../utils/");b.exports=function(a,b){function h(a){return"function"==typeof z?z(a):z=a}function i(a){var b,c;c=e({},a);for(b in c)if(c.hasOwnProperty(b)){if(-1!==G.indexOf(b))continue;if(!/^_/.test(b))continue;delete c[b]}return c._id=""+c.type+"/"+c.id,w.prefix&&(c._id=""+w.prefix+c._id),delete c.id,c}function j(a){var b,c;return b=a._id||a.id,delete a._id,w.prefix&&(b=b.replace(y,"")),c=b.match(/([^\/]+)\/(.*)/),a.type=c[1],a.id=c[2],a}function k(a){return a.map(j)}function l(a){var b,c,d,e;try{e=a._rev.split(/-/),c=e[0],b=e[1]}catch(f){}return c=parseInt(c,10)||0,d=m(),a._$local&&(d+="-local"),a._rev=""+(c+1)+"-"+d,a._revisions={start:1,ids:[d]},b?(a._revisions.start+=c,a._revisions.ids.push(b)):void 0}function m(){return f(9)}function n(a){return a.rows.map(function(a){return a.doc})}function o(){var a;return a=w.getSinceNr(),w.isConnected()&&!A?"/_changes?include_docs=true&since="+a+"&heartbeat=10000&feed=longpoll":"/_changes?include_docs=true&since="+a}function p(){B&&B.abort()}function q(a){return h(a.last_seq),u(a.results),w.isConnected()?w.pull():void 0}function r(b,d){if(w.isConnected())switch(b.status){case 401:return w.trigger("error:unauthenticated",d),w.disconnect();case 404:return c.setTimeout(w.pull,3e3);case 500:return w.trigger("error:server",d),c.setTimeout(w.pull,3e3),a.checkConnection();default:return"abort"===b.statusText?w.pull():(c.setTimeout(w.pull,3e3),a.checkConnection())}}function s(){A=!1,w.trigger("bootstrap:end")}function t(a){A=!1,w.trigger("bootstrap:error",a)}function u(a){for(var b,c,d,e=0;e<a.length;e++)if(b=a[e].doc,!(w.prefix&&0!==b._id.indexOf(w.prefix)||E[b._rev])){if(d=j(b),d._deleted){if(!w.isKnownObject(d))continue;c="remove",w.isKnownObject(d)}else w.isKnownObject(d)?c="update":(c="add",w.markAsKnownObject(d));w.trigger(c,d),w.trigger(c+":"+d.type,d),w.trigger(c+":"+d.type+":"+d.id,d),w.trigger("change",c,d),w.trigger("change:"+d.type,c,d),w.trigger("change:"+d.type+":"+d.id,c,d)}E={}}var v={};v.find=function(a,b){var c;return c=a+"/"+b,w.prefix&&(c=w.prefix+c),c="/"+encodeURIComponent(c),w.request("GET",c).then(j)},v.findAll=function(a){var b,c,d;switch(c="/_all_docs?include_docs=true",!0){case void 0!==a&&""!==w.prefix:d=w.prefix+a+"/";break;case void 0!==a:d=a+"/";break;case""!==w.prefix:d=w.prefix;break;default:d=""}return d&&(b=d.replace(/.$/,function(a){var b;return b=a.charCodeAt(0),String.fromCharCode(b+1)}),c=""+c+'&startkey="'+encodeURIComponent(d)+'"&endkey="'+encodeURIComponent(b)+'"'),w.request("GET",c).then(n).then(k)},v.save=function(a){var b;return a.id||(a.id=f()),a=i(a),b="/"+encodeURIComponent(a._id),w.request("PUT",b,{data:a})},v.remove=function(a,b){return w.update(a,b,{_deleted:!0})},v.removeAll=function(a){return w.updateAll(a,{_deleted:!0})};var w=d(a,{name:b.name,backend:{save:v.save,find:v.find,findAll:v.findAll,remove:v.remove,removeAll:v.removeAll}}),x=null;w.connected=!1,w.prefix="";var y=new RegExp("^");void 0!==b.name&&(x=b.name),void 0!==b.prefix&&(w.prefix=b.prefix,y=new RegExp("^"+w.prefix)),null!==b.baseUrl&&(w.baseUrl=b.baseUrl),w.request=function(b,c,d){return d=d||{},x&&(c="/"+encodeURIComponent(x)+c),w.baseUrl&&(c=""+w.baseUrl+c),d.contentType=d.contentType||"application/json",("POST"===b||"PUT"===b)&&(d.dataType=d.dataType||"json",d.processData=d.processData||!1,d.data=JSON.stringify(d.data)),a.request(b,c,d)},w.isKnownObject=function(a){var b=""+a.type+"/"+a.id;return void 0!==F[b]?F[b]:void 0},w.markAsKnownObject=function(a){var b=""+a.type+"/"+a.id;return F[b]=1,F[b]},w.connect=function(a){return a&&(x=a),w.connected=!0,w.trigger("connect"),w.bootstrap().then(function(){w.push()})},w.disconnect=function(){w.connected=!1,w.trigger("disconnect"),B&&B.abort(),D&&D.abort()},w.isConnected=function(){return w.connected};var z=b.since||0;w.getSinceNr=function(){return"function"==typeof z?z():z};var A=!1;w.bootstrap=function(){return A=!0,w.trigger("bootstrap:start"),w.pull().done(s).fail(t)};var B,C;w.pull=function(){return B=w.request("GET",o()),w.isConnected()&&(c.clearTimeout(C),C=c.setTimeout(p,25e3)),B.done(q).fail(r)};var D,E={};w.push=g.toPromise(function(a,b){var c,d=[];if($.isArray(a)||(a=H()),0===a.length)return b([]);a=a.map(function(a){return e(!0,{},a)}),d=[];for(var f=0;f<a.length;f++)c=a[f],l(c),c=i(c),d.push(c),E[c._rev]=1;return D=w.request("POST","/_bulk_docs",{data:{docs:d,new_edits:!1}}),D.done(function(){for(var b=0;b<a.length;b++)delete a[b]._revisions,w.trigger("push",a[b])}),D}),w.sync=function(a){return w.push(a).then(w.pull)};var F={},G=["_id","_rev","_deleted","_revisions","_attachments"],H=function(){return[]};if(b.defaultObjectsToPush&&(H=$.isArray(b.defaultObjectsToPush)?function(){return b.defaultObjectsToPush}:b.defaultObjectsToPush),b.knownObjects)for(var I=0;I<b.knownObjects.length;I++)w.markAsKnownObject({type:b.knownObjects[I].type,id:b.knownObjects[I].id});return w}},{"../../utils/":48,"../../utils/generate_id":46,"./api":39,extend:4}],42:[function(a,b){var c=a("../events");b.exports=function(a,b,d){var e=d.name||"store",f=d.type,g=d.id,h={};return g||(c(a,{context:h,namespace:e+":"+f}),h.save=function(a,c,d){return b.save(f,a,c,d)},h.add=function(a,c){return b.add(f,a,c)},h.find=function(a){return b.find(f,a)},h.findOrAdd=function(a,c){return b.findOrAdd(f,a,c)},h.findAll=function(a){return b.findAll(f,a)},h.update=function(a,c,d){return b.update(f,a,c,d)},h.updateAll=function(a,c){return b.updateAll(f,a,c)},h.remove=function(a,c){return b.remove(f,a,c)},h.removeAll=function(a){return b.removeAll(f,a)}),g&&(c(a,{context:h,namespace:e+":"+f+":"+g}),h.save=function(a,c){return b.save(f,g,a,c)},h.find=function(){return b.find(f,g)},h.update=function(a,c){return b.update(f,g,a,c)},h.remove=function(a){return b.remove(f,g,a)}),h.decoratePromises=b.decoratePromises,h.validate=b.validate,h}},{"../events":37}],43:[function(a,b){b.exports={scoped:a("./scoped")}},{"./scoped":44}],44:[function(a,b){var c=a("../events");b.exports=function(a,b,d){var e=d.type,f=d.id,g={};return f||(c(a,{context:g,namespace:"task:"+e}),g.start=function(a){return b.start(e,a)},g.abort=function(a){return b.abort(e,a)},g.restart=function(a,c){return b.restart(e,a,c)},g.abortAll=function(){return b.abortAll(e)},g.restartAll=function(a){return b.restartAll(e,a)}),f&&(c(a,{context:g,namespace:"task:"+e+":"+f}),g.abort=function(){return b.abort(e,f)},g.restart=function(a){return b.restart(e,f,a)}),g}},{"../events":37}],45:[function(a,b){function c(){d=e.getObject(h)||{}}var d,e=a("../utils/local_storage_wrapper"),f=a("extend"),g={},h="_hoodie_config";g.set=function(a,b){d[a]=b,e.setObject(h,d)},g.get=function(a){return a?d[a]:f({},d)},g.clear=function(){return d={},e.removeItem(h)},g.unset=function(a){delete d[a],e.setObject(h,d)},c(),b.exports=g},{"../utils/local_storage_wrapper":49,extend:4}],46:[function(a,b){var c,d,e;c="0123456789abcdefghijklmnopqrstuvwxyz".split(""),e=c.length,b.exports=function(a){var b="";for(void 0===a&&(a=7),d=0;a>d;d++){var f=Math.random()*e,g=c[Math.floor(f)];b+=String(g).charAt(0)}return b}},{}],47:[function(a,b,c){var d=/(^\w|_\w)/g;c.hoodiefyRequestErrorName=function(a){return a=a.replace(d,function(a){return(a[1]||a[0]).toUpperCase()}),"Hoodie"+a+"Error"}},{}],48:[function(a,b,c){c.config=a("./config"),c.generate_id=a("./generate_id"),c.local_storage_wrapper=a("./local_storage_wrapper"),c.promise=a("./promise"),c.toPromise=a("pouchdb-topromise"),c.now=function(){return new Date},c.nowStringified=function(){return JSON.stringify(new Date).replace(/['"]/g,"")}},{"./config":45,"./generate_id":46,"./local_storage_wrapper":49,"./promise":50,"pouchdb-topromise":5}],49:[function(a,b,c){function d(){c.isPersistent||(c.getItem=function(){return null},c.setItem=function(){return null},c.removeItem=function(){return null},c.key=function(){return null},c.length=function(){return 0},c.isPersistent=function(){return!1})}var e="undefined"!=typeof self?self:"undefined"!=typeof window?window:{};c.setItem=function(a,b){e.localStorage.setItem(a,b)},c.getItem=function(a){return e.localStorage.getItem(a)},c.removeItem=function(a){return e.localStorage.removeItem(a)},c.clear=function(){return e.localStorage.clear()},c.key=function(a){return e.localStorage.key(a)},c.length=function(){return e.localStorage.length},c.setObject=function(a,b){return c.setItem(a,e.JSON.stringify(b))},c.getObject=function(a){var b=c.getItem(a);if(!b)return null;try{return e.JSON.parse(b)}catch(d){return null}},c.isPersistent=function(){try{if(!e.localStorage)return!1;if(localStorage.setItem("Storage-Test","1"),"1"!==localStorage.getItem("Storage-Test"))return!1;localStorage.removeItem("Storage-Test")}catch(a){return!1}return!0},d()},{}],50:[function(a,b,c){var d="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e=a("../../lib/error/error");c.isPromise=function(a){return!(!a||"function"!=typeof a.done||"function"==typeof a.resolve)},c.defer=d.jQuery.Deferred,c.reject=function(){return c.defer().reject().promise()},c.rejectWith=function(a){var b=new e(a);return c.defer().reject(b).promise()},c.resolve=function(){return c.defer().resolve().promise()},c.resolveWith=function(){return c.defer().resolve.apply(c.defer,arguments).promise()}},{"../../lib/error/error":33}]},{},[24])(24)});