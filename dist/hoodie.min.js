// Hoodie.js - 0.9.1
// https://github.com/hoodiehq/hoodie.js
// Copyright 2012 - 2014 https://github.com/hoodiehq/
// Licensed Apache License 2.0

!function(a){"object"==typeof exports?module.exports=a():"function"==typeof define&&define.amd?define(a):"undefined"!=typeof window?window.Hoodie=a():"undefined"!=typeof global?global.Hoodie=a():"undefined"!=typeof self&&(self.Hoodie=a())}(function(){var a,b,c;return function d(a,b,c){function e(g,h){if(!b[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=b[g]={exports:{}};a[g][0].call(j.exports,function(b){var c=a[g][1][b];return e(c?c:b)},j,j.exports,d,a,b,c)}return b[g].exports}for(var f="function"==typeof require&&require,g=0;g<c.length;g++)e(c[g]);return e}({1:[function(a,b){"use strict";function c(a){return function(){var b=arguments.length;if(b){for(var c=[],d=-1;++d<b;)c[d]=arguments[d];return a.call(this,c)}return a.call(this,[])}}b.exports=c},{}],2:[function(a,b){"use strict";b.exports=function(b,c,d){function e(a,b){var d=c(a,f,b===!0&&a._isBound()?a._boundTo:void 0),e=d.promise();return e.isRejected()?e:(d.setHowMany(1),d.setUnwrap(),d.init(),e)}var f=a("./some_promise_array.js")(d);b.any=function(a){return e(a,!1)},b.prototype.any=function(){return e(this,!0)}}},{"./some_promise_array.js":34}],3:[function(a,b){"use strict";function c(){this._isTickUsed=!1,this._length=0,this._lateBuffer=new e,this._functionBuffer=new e(75e3);var a=this;this.consumeFunctionBuffer=function(){a._consumeFunctionBuffer()}}var d=a("./schedule.js"),e=a("./queue.js"),f=a("./util.js").errorObj,g=a("./util.js").tryCatch1,h=a("./global.js").process;c.prototype.haveItemsQueued=function(){return this._length>0},c.prototype.invokeLater=function(a,b,c){void 0===h||null==h.domain||a.domain||(a=h.domain.bind(a)),this._lateBuffer.push(a,b,c),this._queueTick()},c.prototype.invoke=function(a,b,c){void 0===h||null==h.domain||a.domain||(a=h.domain.bind(a));var d=this._functionBuffer;d.push(a,b,c),this._length=d.length(),this._queueTick()},c.prototype._consumeFunctionBuffer=function(){for(var a=this._functionBuffer;a.length()>0;){var b=a.shift(),c=a.shift(),d=a.shift();b.call(c,d)}this._reset(),this._consumeLateBuffer()},c.prototype._consumeLateBuffer=function(){for(var a=this._lateBuffer;a.length()>0;){var b=a.shift(),c=a.shift(),d=a.shift(),e=g(b,c,d);if(e===f){if(this._queueTick(),null==b.domain)throw e.e;b.domain.emit("error",e.e)}}},c.prototype._queueTick=function(){this._isTickUsed||(d(this.consumeFunctionBuffer),this._isTickUsed=!0)},c.prototype._reset=function(){this._isTickUsed=!1,this._length=0},b.exports=new c},{"./global.js":16,"./queue.js":27,"./schedule.js":30,"./util.js":38}],4:[function(a,b){"use strict";var c=a("./promise.js")();b.exports=c},{"./promise.js":20}],5:[function(a,b){"use strict";b.exports=function(a){function b(a){var b="string"==typeof this?this:""+this;return a[b]}a.prototype.call=function(a){for(var b=arguments.length,c=new Array(b-1),d=1;b>d;++d)c[d-1]=arguments[d];return this._then(function(b){return b[a].apply(b,c)},void 0,void 0,void 0,void 0)},a.prototype.get=function(a){return this._then(b,void 0,void 0,a,void 0)}}},{}],6:[function(a,b){"use strict";b.exports=function(b,c){var d=a("./errors.js"),e=a("./async.js"),f=d.CancellationError;b.prototype._cancel=function(){if(!this.isCancellable())return this;for(var a,b=this;void 0!==(a=b._cancellationParent)&&a.isCancellable();)b=a;var c=new f;b._attachExtraTrace(c),b._rejectUnchecked(c)},b.prototype.cancel=function(){return this.isCancellable()?(e.invokeLater(this._cancel,this,void 0),this):this},b.prototype.cancellable=function(){return this._cancellable()?this:(this._setCancellable(),this._cancellationParent=void 0,this)},b.prototype.uncancellable=function(){var a=new b(c);return a._setTrace(this),a._follow(this),a._unsetCancellable(),this._isBound()&&a._setBoundTo(this._boundTo),a},b.prototype.fork=function(a,b,c){var d=this._then(a,b,c,void 0,void 0);return d._setCancellable(),d._cancellationParent=void 0,d}}},{"./async.js":3,"./errors.js":10}],7:[function(a,b){"use strict";b.exports=function(){function b(a){var b;if("function"==typeof a)b="[function "+(a.name||"anonymous")+"]";else{b=a.toString();var d=/\[object [a-zA-Z0-9$_]+\]/;if(d.test(b))try{var e=JSON.stringify(a);b=e}catch(f){}0===b.length&&(b="(empty array)")}return"(<"+c(b)+">, no stack trace)"}function c(a){var b=41;return a.length<b?a:a.substr(0,b-3)+"..."}function d(a,b){this.captureStackTrace(d,b)}var e=a("./util.js").inherits,f=a("./es5.js").defineProperty,g=new RegExp("\\b(?:[a-zA-Z0-9.]+\\$_\\w+|tryCatch(?:1|2|Apply)|new \\w*PromiseArray|\\w*PromiseArray\\.\\w*PromiseArray|setTimeout|CatchFilter\\$_\\w+|makeNodePromisified|processImmediate|process._tickCallback|nextTick|Async\\$\\w+)\\b"),h=null,i=null;e(d,Error),d.prototype.captureStackTrace=function(a,b){j(this,a,b)},d.possiblyUnhandledRejection=function(a){if("object"==typeof console){var b;if("object"==typeof a||"function"==typeof a){var c=a.stack;b="Possibly unhandled "+i(c,a)}else b="Possibly unhandled "+String(a);"function"==typeof console.error||"object"==typeof console.error?console.error(b):("function"==typeof console.log||"object"==typeof console.log)&&console.log(b)}},d.combine=function(a,b){for(var c=a.length-1,d=b.length-1;d>=0;--d){var e=b[d];if(a[c]!==e)break;a.pop(),c--}a.push("From previous event:");for(var f=a.concat(b),i=[],d=0,j=f.length;j>d;++d)g.test(f[d])||d>0&&!h.test(f[d])&&"From previous event:"!==f[d]||i.push(f[d]);return i},d.isSupported=function(){return"function"==typeof j};var j=function k(){if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){h=/^\s*at\s*/,i=function(a,c){return"string"==typeof a?a:void 0!==c.name&&void 0!==c.message?c.name+". "+c.message:b(c)};var a=Error.captureStackTrace;return function(b,c){a(b,c)}}var c=new Error;if("string"==typeof c.stack&&"function"==typeof"".startsWith&&c.stack.startsWith("stackDetection@")&&"stackDetection"===k.name){f(Error,"stackTraceLimit",{writable:!0,enumerable:!1,configurable:!1,value:25}),h=/@/;var d=/[@\n]/;return i=function(a,c){return"string"==typeof a?c.name+". "+c.message+"\n"+a:void 0!==c.name&&void 0!==c.message?c.name+". "+c.message:b(c)},function(a){for(var b=(new Error).stack,c=b.split(d),e=c.length,f="",g=0;e>g;g+=2)f+=c[g],f+="@",f+=c[g+1],f+="\n";a.stack=f}}return i=function(a,c){return"string"==typeof a?a:"object"!=typeof c&&"function"!=typeof c||void 0===c.name||void 0===c.message?b(c):c.name+". "+c.message},null}();return d}},{"./es5.js":12,"./util.js":38}],8:[function(a,b){"use strict";b.exports=function(b){function c(a,b,c){this._instances=a,this._callback=b,this._promise=c}function d(a,b){var c={},d=g(a,c,b);if(d===h)return d;var e=i(c);return e.length?(h.e=new j("Catch filter must inherit from Error or be a simple predicate function"),h):d}var e=a("./util.js"),f=a("./errors.js"),g=e.tryCatch1,h=e.errorObj,i=a("./es5.js").keys,j=f.TypeError;return c.prototype.doFilter=function(a){for(var c=this._callback,e=this._promise,i=e._isBound()?e._boundTo:void 0,j=0,k=this._instances.length;k>j;++j){var l=this._instances[j],m=l===Error||null!=l&&l.prototype instanceof Error;if(m&&a instanceof l){var n=g(c,i,a);return n===h?(b.e=n.e,b):n}if("function"==typeof l&&!m){var o=d(l,a);if(o===h){var p=f.canAttach(h.e)?h.e:new Error(h.e+"");this._promise._attachExtraTrace(p),a=h.e;break}if(o){var n=g(c,i,a);return n===h?(b.e=n.e,b):n}}}return b.e=a,b},c}},{"./errors.js":10,"./es5.js":12,"./util.js":38}],9:[function(a,b){"use strict";var c=a("./util.js"),d=c.isPrimitive,e=c.wrapsPrimitiveReceiver;b.exports=function(a){var b=function(){return this},c=function(){throw this},f=function(a,b){return 1===b?function(){throw a}:2===b?function(){return a}:void 0};a.prototype["return"]=a.prototype.thenReturn=function(a){return e&&d(a)?this._then(f(a,2),void 0,void 0,void 0,void 0):this._then(b,void 0,void 0,a,void 0)},a.prototype["throw"]=a.prototype.thenThrow=function(a){return e&&d(a)?this._then(f(a,1),void 0,void 0,void 0,void 0):this._then(c,void 0,void 0,a,void 0)}}},{"./util.js":38}],10:[function(a,b){"use strict";function c(a){try{m(a,"isAsync",!0)}catch(b){}}function d(a){return null==a?!1:a instanceof h||a.isAsync===!0}function e(a){return a instanceof n}function f(a){return e(a)}function g(a,b){function c(d){return this instanceof c?(this.message="string"==typeof d?d:b,this.name=a,void(n.captureStackTrace&&n.captureStackTrace(this,this.constructor))):new c(d)}return l(c,n),c}function h(a){this.name="RejectionError",this.message=a,this.cause=a,this.isAsync=!0,a instanceof n?(this.message=a.message,this.stack=a.stack):n.captureStackTrace&&n.captureStackTrace(this,this.constructor)}var i=a("./global.js"),j=a("./es5.js").freeze,k=a("./util.js"),l=k.inherits,m=k.notEnumerableProp,n=i.Error,o=i.TypeError;"function"!=typeof o&&(o=g("TypeError","type error"));var p=i.RangeError;"function"!=typeof p&&(p=g("RangeError","range error"));var q=g("CancellationError","cancellation error"),r=g("TimeoutError","timeout error");l(h,n);var s="__BluebirdErrorTypes__",t=i[s];t||(t=j({CancellationError:q,TimeoutError:r,RejectionError:h}),m(i,s,t)),b.exports={Error:n,TypeError:o,RangeError:p,CancellationError:t.CancellationError,RejectionError:t.RejectionError,TimeoutError:t.TimeoutError,originatesFromRejection:d,markAsOriginatingFromRejection:c,canAttach:f}},{"./es5.js":12,"./global.js":16,"./util.js":38}],11:[function(a,b){"use strict";b.exports=function(b){function c(a){var c=new d(a),e=b.rejected(c),f=e._peekContext();return null!=f&&f._attachExtraTrace(c),e}var d=a("./errors.js").TypeError;return c}},{"./errors.js":10}],12:[function(a,b){var c=function(){"use strict";return void 0===this}();if(c)b.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,keys:Object.keys,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:c};else{var d={}.hasOwnProperty,e={}.toString,f={}.constructor.prototype,g=function(a){var b=[];for(var c in a)d.call(a,c)&&b.push(c);return b},h=function(a,b,c){return a[b]=c.value,a},i=function(a){return a},j=function(a){try{return Object(a).constructor.prototype}catch(b){return f}},k=function(a){try{return"[object Array]"===e.call(a)}catch(b){return!1}};b.exports={isArray:k,keys:g,defineProperty:h,freeze:i,getPrototypeOf:j,isES5:c}}},{}],13:[function(a,b){"use strict";b.exports=function(b){function c(a){for(var c=this instanceof b?this._settledValue:this,d=c.length,e=new Array(d),f=0,g=0;d>g;++g)a[g]&&(e[f++]=c[g]);return e.length=f,e}var d=(a("./util.js").isArray,{ref:null});b.filter=function(a,e){return b.map(a,e,d)._then(c,void 0,void 0,d.ref,void 0)},b.prototype.filter=function(a){return this.map(a,d)._then(c,void 0,void 0,d.ref,void 0)}}},{"./util.js":38}],14:[function(a,b){"use strict";b.exports=function(b,c){function d(){return this}function e(){throw this}function f(a){return function(){return a}}function g(a){return function(){throw a}}function h(a,b,c){var h;return h=l&&m(b)?c?f(b):g(b):c?d:e,a._then(h,n,void 0,b,void 0)}function i(a){var d=this.promise,e=this.handler,f=d._isBound()?e.call(d._boundTo):e();if(void 0!==f){var g=b._cast(f,void 0);if(g instanceof b)return h(g,a,d.isFulfilled())}return d.isRejected()?(c.e=a,c):a}function j(a){var c=this.promise,d=this.handler,e=c._isBound()?d.call(c._boundTo,a):d(a);if(void 0!==e){var f=b._cast(e,void 0);if(f instanceof b)return h(f,a,!0)}return a}var k=a("./util.js"),l=k.wrapsPrimitiveReceiver,m=k.isPrimitive,n=k.thrower;b.prototype._passThroughHandler=function(a,b){if("function"!=typeof a)return this.then();var c={promise:this,handler:a};return this._then(b?i:j,b?i:void 0,void 0,c,void 0)},b.prototype.lastly=b.prototype["finally"]=function(a){return this._passThroughHandler(a,!0)},b.prototype.tap=function(a){return this._passThroughHandler(a,!1)}}},{"./util.js":38}],15:[function(a,b){"use strict";b.exports=function(b,c,d){var e=a("./promise_spawn.js")(b,d),f=a("./errors.js"),g=f.TypeError,h=a("./util.js").deprecated;b.coroutine=function(a){if("function"!=typeof a)throw new g("generatorFunction must be a function");var b=e;return function(){var c=a.apply(this,arguments),d=new b(void 0,void 0);return d._generator=c,d._next(void 0),d.promise()}},b.coroutine.addYieldHandler=e.addYieldHandler,b.spawn=function(a){if(h("Promise.spawn is deprecated. Use Promise.coroutine instead."),"function"!=typeof a)return c("generatorFunction must be a function");var d=new e(a,this),f=d.promise();return d._run(b.spawn),f}}},{"./errors.js":10,"./promise_spawn.js":23,"./util.js":38}],16:[function(a,b){var c="undefined"!=typeof self?self:"undefined"!=typeof window?window:{};b.exports=function(){if(void 0!==this)return this;try{return c}catch(a){}try{return window}catch(a){}try{return self}catch(a){}}()},{}],17:[function(a,b){"use strict";b.exports=function(b,c,d,e){function f(a){return g(a,this[0],this[1],this[2])}function g(a,c,g,i){if("function"!=typeof c)return e("fn must be a function");var j=void 0;g===!0?a._isBound()&&(j=a._boundTo):g!==!1&&(j=g);var k=void 0!==i;if(k&&(i.ref=a),a instanceof b){var m=[c,j,i];return a._then(f,void 0,void 0,m,void 0)}if(!l(a))return e("expecting an array, a promise or a thenable");var n=new b(d);void 0!==j&&n._setBoundTo(j),n._setTrace(void 0);var o=new h(n,c,a,j,k);return o.init(),n}function h(a,b,c,d,e){this.shouldUnwrapItems=e,this.index=0,this.items=c,this.callback=b,this.receiver=d,this.promise=a,this.result=new Array(c.length)}var i=b.all,j=a("./util.js"),k=a("./errors.js").canAttach,l=j.isArray,m=b._cast,n={};j.inherits(h,c),h.prototype.init=function(){for(var a=this.items,c=a.length,d=this.result,e=!1,f=0;c>f;++f){var g=m(a[f],void 0);g instanceof b?g.isPending()?(d[f]=n,g._proxyPromiseArray(this,f)):g.isFulfilled()?d[f]=g.value():(g._unsetRejectionIsUnhandled(),e||(this.reject(g.reason()),e=!0)):d[f]=g}e||this.iterate()},h.prototype.isResolved=function(){return null===this.promise},h.prototype._promiseProgressed=function(a){this.isResolved()||this.promise._progress(a)},h.prototype._promiseFulfilled=function(a,b){this.isResolved()||(this.result[b]=a,this.shouldUnwrapItems&&(this.items[b]=a),this.index===b&&this.iterate())},h.prototype._promiseRejected=function(a){this.reject(a)},h.prototype.reject=function(a){if(!this.isResolved()){var b=k(a)?a:new Error(a+"");this.promise._attachExtraTrace(b),this.promise._reject(a,b)}},h.prototype.iterate=function(){for(var a=this.index,b=this.items,c=this.result,d=b.length,c=this.result,e=this.receiver,f=this.callback;d>a;++a){var g=c[a];if(g===n)return void(this.index=a);try{c[a]=f.call(e,g,a,d)}catch(h){return this.reject(h)}}this.promise._follow(i(c)),this.items=this.result=this.callback=this.promise=null},b.prototype.map=function(a,b){return g(this,a,!0,b)},b.map=function(a,b,c){return g(a,b,!1,c)}}},{"./errors.js":10,"./util.js":38}],18:[function(a,b){"use strict";b.exports=function(b){function c(a){throw a}function d(a,b){var d=this,e=void 0===a?i(d,b,null):h(d,b,null,a);e===j&&g.invokeLater(c,void 0,e.e)}function e(a,b){var d=this,e=i(d,b,a);e===j&&g.invokeLater(c,void 0,e.e)}var f=a("./util.js"),g=a("./async.js"),h=f.tryCatch2,i=f.tryCatch1,j=f.errorObj;b.prototype.nodeify=function(a){return"function"==typeof a&&this._then(d,e,void 0,a,this._isBound()?this._boundTo:null),this}}},{"./async.js":3,"./util.js":38}],19:[function(a,b){"use strict";b.exports=function(b,c){var d=a("./util.js"),e=a("./async.js"),f=a("./errors.js"),g=d.tryCatch1,h=d.errorObj;b.prototype.progressed=function(a){return this._then(void 0,void 0,a,void 0,void 0)},b.prototype._progress=function(a){this._isFollowingOrFulfilledOrRejected()||this._progressUnchecked(a)},b.prototype._progressHandlerAt=function(a){return 0===a?this._progressHandler0:this[a+2-5]},b.prototype._doProgressWith=function(a){var c=a.value,d=a.handler,e=a.promise,i=a.receiver;this._pushContext();var j=g(d,i,c);if(this._popContext(),j===h){if(null!=j.e&&"StopProgressPropagation"!==j.e.name){var k=f.canAttach(j.e)?j.e:new Error(j.e+"");e._attachExtraTrace(k),e._progress(j.e)}}else j instanceof b?j._then(e._progress,null,null,e,void 0):e._progress(j)},b.prototype._progressUnchecked=function(a){if(this.isPending())for(var d=this._length(),f=this._progress,g=0;d>g;g+=5){var h=this._progressHandlerAt(g),i=this._promiseAt(g);if(i instanceof b)"function"==typeof h?e.invoke(this._doProgressWith,this,{handler:h,promise:i,receiver:this._receiverAt(g),value:a}):e.invoke(f,i,a);else{var j=this._receiverAt(g);"function"==typeof h?h.call(j,a,i):j instanceof b&&j._isProxied()?j._progressUnchecked(a):c(j,i)&&j._promiseProgressed(a,i)}}}}},{"./async.js":3,"./errors.js":10,"./util.js":38}],20:[function(a,b){var c=a("__browserify_process");b.exports=function(){function b(a){return void 0===a?!1:a instanceof e}function d(a,b){return a instanceof o?b>=0:!1}function e(a){if("function"!=typeof a)throw new y("the promise constructor requires a resolver function");if(this.constructor!==e)throw new y("the promise constructor cannot be invoked directly");this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._settledValue=void 0,this._boundTo=void 0,a!==l&&this._resolveFromResolver(a)}function f(a,b){return g(a,o,b===!0&&a._isBound()?a._boundTo:void 0).promise()}function g(a,c,d){var f=null;return s(a)?f=a:(f=e._cast(a,void 0),f!==a?f._setBoundTo(d):b(f)||(f=null)),null!==f?new c(f,d):{promise:function(){return G("expecting an array, a promise or a thenable")}}}var h=a("./global.js"),i=a("./util.js"),j=a("./async.js"),k=a("./errors.js"),l=function(){},m={},n={e:null},o=a("./promise_array.js")(e,l),p=a("./captured_trace.js")(),q=a("./catch_filter.js")(n),r=a("./promise_resolver.js"),s=i.isArray,t=i.errorObj,u=i.tryCatch1,v=i.tryCatch2,w=i.tryCatchApply,x=k.RangeError,y=k.TypeError,z=k.CancellationError,A=k.TimeoutError,B=k.RejectionError,C=k.originatesFromRejection,D=k.markAsOriginatingFromRejection,E=k.canAttach,F=i.thrower,G=a("./errors_api_rejection")(e),H=function(){return new y("circular promise resolution chain")};e.prototype.bind=function(a){var b=new e(l);return b._setTrace(this),b._follow(this),b._setBoundTo(a),this._cancellable()&&(b._setCancellable(),b._cancellationParent=this),b},e.prototype.toString=function(){return"[object Promise]"},e.prototype.caught=e.prototype["catch"]=function(a){var b=arguments.length;if(b>1){var c,d=new Array(b-1),e=0;for(c=0;b-1>c;++c){var f=arguments[c];if("function"!=typeof f){var g=new y("A catch filter must be an error constructor or a filter function");return this._attachExtraTrace(g),void j.invoke(this._reject,this,g)}d[e++]=f}d.length=e,a=arguments[c],this._resetTrace();var h=new q(d,a,this);return this._then(void 0,h.doFilter,void 0,h,void 0)}return this._then(void 0,a,void 0,void 0,void 0)},e.prototype.then=function(a,b,c){return this._then(a,b,c,void 0,void 0)},e.prototype.done=function(a,b,c){var d=this._then(a,b,c,void 0,void 0);d._setIsFinal()},e.prototype.spread=function(a,b){return this._then(a,b,void 0,m,void 0)},e.prototype.isCancellable=function(){return!this.isResolved()&&this._cancellable()},e.prototype.toJSON=function(){var a={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(a.fulfillmentValue=this._settledValue,a.isFulfilled=!0):this.isRejected()&&(a.rejectionReason=this._settledValue,a.isRejected=!0),a},e.prototype.all=function(){return f(this,!0)},e.is=b,e.all=function(a){return f(a,!1)},e.join=function(){for(var a=arguments.length,b=new Array(a),c=0;a>c;++c)b[c]=arguments[c];return g(b,o,void 0).promise()},e.resolve=e.fulfilled=function(a){var b=new e(l);return b._setTrace(void 0),b._tryFollow(a)?b:(b._cleanValues(),b._setFulfilled(),b._settledValue=a,b)},e.reject=e.rejected=function(a){var b=new e(l);if(b._setTrace(void 0),D(a),b._cleanValues(),b._setRejected(),b._settledValue=a,!E(a)){var c=new Error(a+"");b._setCarriedStackTrace(c)}return b._ensurePossibleRejectionHandled(),b},e.prototype.error=function(a){return this.caught(C,a)},e.prototype._resolveFromSyncValue=function(a){if(a===t)this._cleanValues(),this._setRejected(),this._settledValue=a.e,this._ensurePossibleRejectionHandled();else{var b=e._cast(a,void 0);b instanceof e?this._follow(b):(this._cleanValues(),this._setFulfilled(),this._settledValue=a)}},e.method=function(a){if("function"!=typeof a)throw new y("fn must be a function");return function(){var b;switch(arguments.length){case 0:b=u(a,this,void 0);break;case 1:b=u(a,this,arguments[0]);break;case 2:b=v(a,this,arguments[0],arguments[1]);break;default:for(var c=arguments.length,d=new Array(c),f=0;c>f;++f)d[f]=arguments[f];b=w(a,d,this)}var g=new e(l);return g._setTrace(void 0),g._resolveFromSyncValue(b),g}},e.attempt=e["try"]=function(a,b,c){if("function"!=typeof a)return G("fn must be a function");var d=s(b)?w(a,b,c):u(a,c,b),f=new e(l);return f._setTrace(void 0),f._resolveFromSyncValue(d),f},e.defer=e.pending=function(){var a=new e(l);return a._setTrace(void 0),new r(a)},e.bind=function(a){var b=new e(l);return b._setTrace(void 0),b._setFulfilled(),b._setBoundTo(a),b},e.cast=function(a){var b=e._cast(a,void 0);return b instanceof e?b:e.resolve(b)},e.onPossiblyUnhandledRejection=function(a){p.possiblyUnhandledRejection="function"==typeof a?a:void 0};var I;e.onUnhandledRejectionHandled=function(a){I="function"==typeof a?a:void 0};var J=!1||!("undefined"==typeof c||"string"!=typeof c.execPath||"object"!=typeof c.env||!c.env.BLUEBIRD_DEBUG&&"development"!==c.env.NODE_ENV);e.longStackTraces=function(){if(j.haveItemsQueued()&&J===!1)throw new Error("cannot enable long stack traces after promises have been created");J=p.isSupported()},e.hasLongStackTraces=function(){return J&&p.isSupported()},e.prototype._setProxyHandlers=function(a,b){var c=this._length();if(c>=524282&&(c=0,this._setLength(0)),0===c)this._promise0=b,this._receiver0=a;else{var d=c-5;this[d+3]=b,this[d+4]=a,this[d+0]=this[d+1]=this[d+2]=void 0}this._setLength(c+5)},e.prototype._proxyPromiseArray=function(a,b){this._setProxyHandlers(a,b)},e.prototype._proxyPromise=function(a){a._setProxied(),this._setProxyHandlers(a,-1)},e.prototype._then=function(a,b,c,d,f){var g=void 0!==f,h=g?f:new e(l);if(J&&!g){var i=this._peekContext()===this._traceParent;h._traceParent=i?this._traceParent:this,h._setTrace(this)}!g&&this._isBound()&&h._setBoundTo(this._boundTo);var k=this._addCallbacks(a,b,c,h,d);return!g&&this._cancellable()&&(h._setCancellable(),h._cancellationParent=this),this.isResolved()&&j.invoke(this._queueSettleAt,this,k),h},e.prototype._length=function(){return 524287&this._bitField},e.prototype._isFollowingOrFulfilledOrRejected=function(){return(939524096&this._bitField)>0},e.prototype._isFollowing=function(){return 536870912===(536870912&this._bitField)},e.prototype._setLength=function(a){this._bitField=-524288&this._bitField|524287&a},e.prototype._setFulfilled=function(){this._bitField=268435456|this._bitField},e.prototype._setRejected=function(){this._bitField=134217728|this._bitField},e.prototype._setFollowing=function(){this._bitField=536870912|this._bitField},e.prototype._setIsFinal=function(){this._bitField=33554432|this._bitField},e.prototype._isFinal=function(){return(33554432&this._bitField)>0},e.prototype._cancellable=function(){return(67108864&this._bitField)>0},e.prototype._setCancellable=function(){this._bitField=67108864|this._bitField},e.prototype._unsetCancellable=function(){this._bitField=-67108865&this._bitField},e.prototype._setRejectionIsUnhandled=function(){this._bitField=2097152|this._bitField},e.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-2097153&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},e.prototype._isRejectionUnhandled=function(){return(2097152&this._bitField)>0},e.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=524288|this._bitField},e.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-524289&this._bitField},e.prototype._isUnhandledRejectionNotified=function(){return(524288&this._bitField)>0},e.prototype._setCarriedStackTrace=function(a){this._bitField=1048576|this._bitField,this._fulfillmentHandler0=a},e.prototype._unsetCarriedStackTrace=function(){this._bitField=-1048577&this._bitField,this._fulfillmentHandler0=void 0},e.prototype._isCarryingStackTrace=function(){return(1048576&this._bitField)>0},e.prototype._getCarriedStackTrace=function(){return this._isCarryingStackTrace()?this._fulfillmentHandler0:void 0},e.prototype._receiverAt=function(a){var b;return b=0===a?this._receiver0:this[a+4-5],this._isBound()&&void 0===b?this._boundTo:b},e.prototype._promiseAt=function(a){return 0===a?this._promise0:this[a+3-5]},e.prototype._fulfillmentHandlerAt=function(a){return 0===a?this._fulfillmentHandler0:this[a+0-5]},e.prototype._rejectionHandlerAt=function(a){return 0===a?this._rejectionHandler0:this[a+1-5]},e.prototype._unsetAt=function(a){0===a?(this._rejectionHandler0=this._progressHandler0=this._promise0=this._receiver0=void 0,this._isCarryingStackTrace()||(this._fulfillmentHandler0=void 0)):this[a-5+0]=this[a-5+1]=this[a-5+2]=this[a-5+3]=this[a-5+4]=void 0},e.prototype._resolveFromResolver=function(a){function b(a){d._tryFollow(a)||d._fulfill(a)}function c(a){var b=E(a)?a:new Error(a+"");d._attachExtraTrace(b),D(a),d._reject(a,b===a?void 0:b)}var d=this;this._setTrace(void 0),this._pushContext();var e=v(a,void 0,b,c);if(this._popContext(),void 0!==e&&e===t){var f=e.e,g=E(f)?f:new Error(f+"");d._reject(f,g)}},e.prototype._addCallbacks=function(a,b,c,d,e){var f=this._length();if(f>=524282&&(f=0,this._setLength(0)),0===f)this._promise0=d,void 0!==e&&(this._receiver0=e),"function"!=typeof a||this._isCarryingStackTrace()||(this._fulfillmentHandler0=a),"function"==typeof b&&(this._rejectionHandler0=b),"function"==typeof c&&(this._progressHandler0=c);else{var g=f-5;this[g+3]=d,this[g+4]=e,this[g+0]="function"==typeof a?a:void 0,this[g+1]="function"==typeof b?b:void 0,this[g+2]="function"==typeof c?c:void 0}return this._setLength(f+5),f},e.prototype._setBoundTo=function(a){void 0!==a?(this._bitField=8388608|this._bitField,this._boundTo=a):this._bitField=-8388609&this._bitField},e.prototype._isBound=function(){return 8388608===(8388608&this._bitField)},e.prototype._spreadSlowCase=function(a,b,c,d){var e=g(c,o,d).promise()._then(function(){return a.apply(d,arguments)},void 0,void 0,m,void 0);b._follow(e)},e.prototype._callSpread=function(a,c,d,f){var g=this._isBound()?this._boundTo:void 0;if(s(d))for(var h=0,i=d.length;i>h;++h)if(b(e._cast(d[h],void 0)))return void this._spreadSlowCase(a,c,d,g);return f&&c._pushContext(),w(a,d,g)},e.prototype._callHandler=function(a,b,c,d,e){var f;return b!==m||this.isRejected()?(e&&c._pushContext(),f=u(a,b,d)):f=this._callSpread(a,c,d,e),e&&c._popContext(),f},e.prototype._settlePromiseFromHandler=function(a,c,d,f){if(!b(f))return void a.call(c,d,f);var g=J,h=this._callHandler(a,c,f,d,g);if(!f._isFollowing())if(h===t||h===f||h===n){var i=h===f?H():h.e,j=E(i)?i:new Error(i+"");h!==n&&f._attachExtraTrace(j),f._rejectUnchecked(i,j)}else{var k=e._cast(h,f);if(b(k)){if(k.isRejected()&&!k._isCarryingStackTrace()&&!E(k._settledValue)){var j=new Error(k._settledValue+"");f._attachExtraTrace(j),k._setCarriedStackTrace(j)}f._follow(k),k._cancellable()&&(f._cancellationParent=k,f._setCancellable())}else f._fulfillUnchecked(h)}},e.prototype._follow=function(a){this._setFollowing(),a.isPending()?(a._cancellable()&&(this._cancellationParent=a,this._setCancellable()),a._proxyPromise(this)):a.isFulfilled()?this._fulfillUnchecked(a._settledValue):this._rejectUnchecked(a._settledValue,a._getCarriedStackTrace()),a._isRejectionUnhandled()&&a._unsetRejectionIsUnhandled(),J&&null==a._traceParent&&(a._traceParent=this)},e.prototype._tryFollow=function(a){if(this._isFollowingOrFulfilledOrRejected()||a===this)return!1;var c=e._cast(a,void 0);return b(c)?(this._follow(c),!0):!1},e.prototype._resetTrace=function(){J&&(this._trace=new p(void 0===this._peekContext()))},e.prototype._setTrace=function(a){if(J){var b=this._peekContext();this._traceParent=b;var c=void 0===b;this._trace=void 0!==a&&a._traceParent===b?a._trace:new p(c)}return this},e.prototype._attachExtraTrace=function(a){if(J){var b=this,c=a.stack;c="string"==typeof c?c.split("\n"):[];for(var d=1;null!=b&&null!=b._trace;)c=p.combine(c,b._trace.stack.split("\n")),b=b._traceParent;var e=Error.stackTraceLimit+d,f=c.length;f>e&&(c.length=e),a.stack=c.length<=d?"(No stack trace)":c.join("\n")}},e.prototype._cleanValues=function(){this._cancellable()&&(this._cancellationParent=void 0)},e.prototype._fulfill=function(a){this._isFollowingOrFulfilledOrRejected()||this._fulfillUnchecked(a)},e.prototype._reject=function(a,b){this._isFollowingOrFulfilledOrRejected()||this._rejectUnchecked(a,b)},e.prototype._settlePromiseAt=function(a){var b=this.isFulfilled()?this._fulfillmentHandlerAt(a):this._rejectionHandlerAt(a),c=this._settledValue,f=this._receiverAt(a),g=this._promiseAt(a);if("function"==typeof b)this._settlePromiseFromHandler(b,f,c,g);else{var h=!1,i=this.isFulfilled();void 0!==f&&(f instanceof e&&f._isProxied()?(f._unsetProxied(),i?f._fulfillUnchecked(c):f._rejectUnchecked(c,this._getCarriedStackTrace()),h=!0):d(f,g)&&(i?f._promiseFulfilled(c,g):f._promiseRejected(c,g),h=!0)),h||(i?g._fulfill(c):g._reject(c,this._getCarriedStackTrace()))}a>=256&&this._queueGC()},e.prototype._isProxied=function(){return 4194304===(4194304&this._bitField)},e.prototype._setProxied=function(){this._bitField=4194304|this._bitField},e.prototype._unsetProxied=function(){this._bitField=-4194305&this._bitField},e.prototype._isGcQueued=function(){return-1073741824===(-1073741824&this._bitField)},e.prototype._setGcQueued=function(){this._bitField=-1073741824|this._bitField},e.prototype._unsetGcQueued=function(){this._bitField=1073741823&this._bitField},e.prototype._queueGC=function(){this._isGcQueued()||(this._setGcQueued(),j.invokeLater(this._gc,this,void 0))},e.prototype._gc=function(){var a=this._length();this._unsetAt(0);for(var b=0;a>b;b++)delete this[b];this._setLength(0),this._unsetGcQueued()},e.prototype._queueSettleAt=function(a){this._isRejectionUnhandled()&&this._unsetRejectionIsUnhandled(),j.invoke(this._settlePromiseAt,this,a)},e.prototype._fulfillUnchecked=function(a){if(this.isPending()){if(a===this){var b=H();return this._attachExtraTrace(b),this._rejectUnchecked(b,void 0)}this._cleanValues(),this._setFulfilled(),this._settledValue=a;var c=this._length();c>0&&j.invoke(this._settlePromises,this,c)}},e.prototype._rejectUncheckedCheckError=function(a){var b=E(a)?a:new Error(a+"");this._rejectUnchecked(a,b===a?void 0:b)},e.prototype._rejectUnchecked=function(a,b){if(this.isPending()){if(a===this){var c=H();return this._attachExtraTrace(c),this._rejectUnchecked(c)}if(this._cleanValues(),this._setRejected(),this._settledValue=a,this._isFinal())return void j.invokeLater(F,void 0,void 0===b?a:b);var d=this._length();void 0!==b&&this._setCarriedStackTrace(b),d>0?j.invoke(this._rejectPromises,this,null):this._ensurePossibleRejectionHandled()}},e.prototype._rejectPromises=function(){this._settlePromises(),this._unsetCarriedStackTrace()},e.prototype._settlePromises=function(){for(var a=this._length(),b=0;a>b;b+=5)this._settlePromiseAt(b)},e.prototype._ensurePossibleRejectionHandled=function(){this._setRejectionIsUnhandled(),void 0!==p.possiblyUnhandledRejection&&j.invokeLater(this._notifyUnhandledRejection,this,void 0)},e.prototype._notifyUnhandledRejectionIsHandled=function(){"function"==typeof I&&j.invokeLater(I,void 0,this)},e.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var a=this._settledValue,b=this._getCarriedStackTrace();this._setUnhandledRejectionIsNotified(),void 0!==b&&(this._unsetCarriedStackTrace(),a=b),"function"==typeof p.possiblyUnhandledRejection&&p.possiblyUnhandledRejection(a,this)}};var K=[];e.prototype._peekContext=function(){var a=K.length-1;return a>=0?K[a]:void 0},e.prototype._pushContext=function(){J&&K.push(this)
},e.prototype._popContext=function(){J&&K.pop()};var L=h.Promise;return e.noConflict=function(){return h.Promise===e&&(h.Promise=L),e},p.isSupported()||(e.longStackTraces=function(){},J=!1),e._makeSelfResolutionError=H,a("./finally.js")(e,n),a("./direct_resolve.js")(e),a("./thenables.js")(e,l),a("./synchronous_inspection.js")(e),e.RangeError=x,e.CancellationError=z,e.TimeoutError=A,e.TypeError=y,e.RejectionError=B,i.toFastProperties(e),i.toFastProperties(e.prototype),a("./timers.js")(e,l),a("./any.js")(e,g,o),a("./race.js")(e,l),a("./call_get.js")(e),a("./filter.js")(e,g,o,G),a("./generators.js")(e,G,l),a("./map.js")(e,o,l,G),a("./nodeify.js")(e),a("./promisify.js")(e,l),a("./props.js")(e,o),a("./reduce.js")(e,g,o,G,l),a("./settle.js")(e,g,o),a("./some.js")(e,g,o,G),a("./progress.js")(e,d),a("./cancel.js")(e,l),e.prototype=e.prototype,e}},{"./any.js":2,"./async.js":3,"./call_get.js":5,"./cancel.js":6,"./captured_trace.js":7,"./catch_filter.js":8,"./direct_resolve.js":9,"./errors.js":10,"./errors_api_rejection":11,"./filter.js":13,"./finally.js":14,"./generators.js":15,"./global.js":16,"./map.js":17,"./nodeify.js":18,"./progress.js":19,"./promise_array.js":21,"./promise_resolver.js":22,"./promisify.js":24,"./props.js":26,"./race.js":28,"./reduce.js":29,"./settle.js":31,"./some.js":33,"./synchronous_inspection.js":35,"./thenables.js":36,"./timers.js":37,"./util.js":38,__browserify_process:39}],21:[function(a,b){"use strict";b.exports=function(b,c){function d(a){switch(a){case-1:return void 0;case-2:return[];case-3:return{}}}function e(a,d){var e=this._promise=new b(c),f=void 0;a instanceof b&&(f=a,a._cancellable()&&(e._setCancellable(),e._cancellationParent=a),a._isBound()&&e._setBoundTo(d)),e._setTrace(f),this._values=a,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var f=a("./errors.js").canAttach,g=a("./util.js"),h=a("./async.js"),i={}.hasOwnProperty,j=g.isArray;return e.PropertiesPromiseArray=function(){},e.prototype.length=function(){return this._length},e.prototype.promise=function(){return this._promise},e.prototype._init=function(a,c){var f=this._values;if(f instanceof b){if(!f.isFulfilled())return f.isPending()?void f._then(this._init,this._reject,void 0,this,c):(f._unsetRejectionIsUnhandled(),void this._reject(f._settledValue));if(f=f._settledValue,!j(f)){var g=new b.TypeError("expecting an array, a promise or a thenable");return void this.__hardReject__(g)}this._values=f}if(0===f.length)return void this._resolve(d(c));var k,l=f.length,m=l;k=this instanceof e.PropertiesPromiseArray?this._values:new Array(l);for(var n=!1,o=0;l>o;++o){var p=f[o];if(void 0!==p||i.call(f,o)){var q=b._cast(p,void 0);q instanceof b?q.isPending()?q._proxyPromiseArray(this,o):(q._unsetRejectionIsUnhandled(),n=!0):n=!0,k[o]=q}else m--}if(0===m)return void this._resolve(-2===c?k:d(c));if(this._values=k,this._length=m,n){var r=m===l?this._scanDirectValues:this._scanDirectValuesHoled;h.invoke(r,this,l)}},e.prototype._settlePromiseAt=function(a){var c=this._values[a];c instanceof b?c.isFulfilled()?this._promiseFulfilled(c._settledValue,a):c.isRejected()&&this._promiseRejected(c._settledValue,a):this._promiseFulfilled(c,a)},e.prototype._scanDirectValuesHoled=function(a){for(var b=0;a>b&&!this._isResolved();++b)i.call(this._values,b)&&this._settlePromiseAt(b)},e.prototype._scanDirectValues=function(a){for(var b=0;a>b&&!this._isResolved();++b)this._settlePromiseAt(b)},e.prototype._isResolved=function(){return null===this._values},e.prototype._resolve=function(a){this._values=null,this._promise._fulfill(a)},e.prototype.__hardReject__=e.prototype._reject=function(a){this._values=null;var b=f(a)?a:new Error(a+"");this._promise._attachExtraTrace(b),this._promise._reject(a,b)},e.prototype._promiseProgressed=function(a,b){this._isResolved()||this._promise._progress({index:b,value:a})},e.prototype._promiseFulfilled=function(a,b){if(!this._isResolved()){this._values[b]=a;var c=++this._totalResolved;c>=this._length&&this._resolve(this._values)}},e.prototype._promiseRejected=function(a){this._isResolved()||(this._totalResolved++,this._reject(a))},e}},{"./async.js":3,"./errors.js":10,"./util.js":38}],22:[function(a,b){"use strict";function c(a){return a instanceof Error&&n.getPrototypeOf(a)===Error.prototype}function d(a){var b;return b=c(a)?new k(a):a,i.markAsOriginatingFromRejection(b),b}function e(a){function b(b,c){if(null!==a){if(b){var e=d(h(b));a._attachExtraTrace(e),a._reject(e)}else if(arguments.length>2){for(var f=arguments.length,g=new Array(f-1),i=1;f>i;++i)g[i-1]=arguments[i];a._fulfill(g)}else a._fulfill(c);a=null}}return b}var f,g=a("./util.js"),h=g.maybeWrapAsError,i=a("./errors.js"),j=i.TimeoutError,k=i.RejectionError,l=a("./async.js"),m=g.haveGetters,n=a("./es5.js");if(f=m?function(a){this.promise=a}:function(a){this.promise=a,this.asCallback=e(a),this.callback=this.asCallback},m){var o={get:function(){return e(this.promise)}};n.defineProperty(f.prototype,"asCallback",o),n.defineProperty(f.prototype,"callback",o)}f._nodebackForPromise=e,f.prototype.toString=function(){return"[object PromiseResolver]"},f.prototype.resolve=f.prototype.fulfill=function(a){var b=this.promise;if(void 0===b||void 0===b._tryFollow)throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.");b._tryFollow(a)||l.invoke(b._fulfill,b,a)},f.prototype.reject=function(a){var b=this.promise;if(void 0===b||void 0===b._attachExtraTrace)throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.");i.markAsOriginatingFromRejection(a);var c=i.canAttach(a)?a:new Error(a+"");b._attachExtraTrace(c),l.invoke(b._reject,b,a),c!==a&&l.invoke(this._setCarriedStackTrace,this,c)},f.prototype.progress=function(a){l.invoke(this.promise._progress,this.promise,a)},f.prototype.cancel=function(){l.invoke(this.promise.cancel,this.promise,void 0)},f.prototype.timeout=function(){this.reject(new j("timeout"))},f.prototype.isResolved=function(){return this.promise.isResolved()},f.prototype.toJSON=function(){return this.promise.toJSON()},f.prototype._setCarriedStackTrace=function(a){this.promise.isRejected()&&this.promise._setCarriedStackTrace(a)},b.exports=f},{"./async.js":3,"./errors.js":10,"./es5.js":12,"./util.js":38}],23:[function(a,b){"use strict";b.exports=function(b,c){function d(a){for(var c=l,e=j,f=b,g=c.length,h=0;g>h;++h){var i=k(c[h],void 0,a);if(i===e)return f.reject(e.e);var m=f._cast(i,d,void 0);if(m instanceof f)return m}return null}function e(a,d){var e=this._promise=new b(c);e._setTrace(void 0),this._generatorFunction=a,this._receiver=d,this._generator=void 0}var f=a("./errors.js"),g=f.TypeError,h=a("./util.js"),i=h.isArray,j=h.errorObj,k=h.tryCatch1,l=[];return e.prototype.promise=function(){return this._promise},e.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._next(void 0)},e.prototype._continue=function m(a){if(a===j){this._generator=void 0;var c=f.canAttach(a.e)?a.e:new Error(a.e+"");return this._promise._attachExtraTrace(c),void this._promise._reject(a.e,c)}var e=a.value;if(a.done===!0)this._generator=void 0,this._promise._tryFollow(e)||this._promise._fulfill(e);else{var h=b._cast(e,m,void 0);if(!(h instanceof b)&&(h=i(h)?b.all(h):d(h),null===h))return void this._throw(new g("A value was yielded that could not be treated as a promise"));h._then(this._next,this._throw,void 0,this,null)}},e.prototype._throw=function(a){f.canAttach(a)&&this._promise._attachExtraTrace(a),this._continue(k(this._generator["throw"],this._generator,a))},e.prototype._next=function(a){this._continue(k(this._generator.next,this._generator,a))},e.addYieldHandler=function(a){if("function"!=typeof a)throw new g("fn must be a function");l.push(a)},e}},{"./errors.js":10,"./util.js":38}],24:[function(a,b){"use strict";b.exports=function(b,c){function d(a){return a.__isPromisified__===!0}function e(a,b){var c=b+"Async"in a;return c?d(a[b+"Async"]):!1}function f(a){for(var b=0;b<a.length;b+=2){var c=a[b];if(w.test(c))for(var d=c.replace(w,""),e=0;e<a.length;e+=2)if(a[e]===d)throw new v("Cannot promisify an API that has normal methods with Async-suffix")}}function g(a){for(var b=[a],c=Math.max(0,a-1-5),d=a-1;d>=c;--d)d!==a&&b.push(d);for(var d=a+1;5>=d;++d)b.push(d);return b}function h(a){for(var b=new Array(a),c=0;c<b.length;++c)b[c]="_arg"+c;return b.join(", ")}function i(a){return"number"==typeof a.length?Math.max(Math.min(a.length,1024),0):0}function j(a){return y.test(a)?"."+a:"['"+a.replace(/(['\\])/g,"\\$1")+"']"}function k(a,d,e,f){function k(b){for(var c=new Array(b),e=0,f=c.length;f>e;++e)c[e]="arguments["+e+"]";var g=b>0?",":"";return"string"==typeof a&&d===n?"this"+j(a)+"("+c.join(",")+g+" fn);break;":(void 0===d?"callback("+c.join(",")+g+" fn);":"callback.call("+(d===n?"this":"receiver")+", "+c.join(",")+g+" fn);")+"break;"}function l(){for(var b="",c=0;c<o.length;++c)b+="case "+o[c]+":"+k(o[c]);return b+="default: var args = new Array(len + 1);var i = 0;for (var i = 0; i < len; ++i) {    args[i] = arguments[i];}args[i] = fn;"+("string"==typeof a?"this"+j(a)+".apply(":"callback.apply(")+(d===n?"this":"receiver")+", args); break;"}var m=Math.max(0,i(f)-1),o=g(m),p="string"==typeof e?e+"Async":"promisified";return y.test(p)||(p="promisified"),new Function("Promise","callback","receiver","withAppended","maybeWrapAsError","nodebackForPromise","INTERNAL","var ret = function "+p+"("+h(m)+') {"use strict";var len = arguments.length;var promise = new Promise(INTERNAL);promise._setTrace(void 0);var fn = nodebackForPromise(promise);try {switch(len) {'+l()+"}}catch(e){ var wrapped = maybeWrapAsError(e);promise._attachExtraTrace(wrapped);promise._reject(wrapped);}return promise;}; ret.__isPromisified__ = true; return ret;")(b,a,d,r,s,q,c)}function l(a,d){function e(){var e=d;d===n&&(e=this),"string"==typeof a&&(a=e[a]);var f=new b(c);f._setTrace(void 0);var g=q(f);try{a.apply(e,r(arguments,g))}catch(h){var i=s(h);f._attachExtraTrace(i),f._reject(i)}return f}return e.__isPromisified__=!0,e}function m(a,b,c){if(c){for(var d=x(a),e=0,f=d.length;f>e;e+=2){var g=d[e],h=d[e+1],i=g+"Async";a[i]=z(g,n,g,h)}return o.toFastProperties(a),a}return z(a,b,void 0,a)}var n={},o=a("./util.js"),p=a("./es5.js"),q=a("./promise_resolver.js")._nodebackForPromise,r=o.withAppended,s=o.maybeWrapAsError,t=o.canEvaluate,u=o.deprecated,v=a("./errors").TypeError,w=new RegExp("Async$"),x=function(){if(p.isES5){var a=Object.create,b=Object.getOwnPropertyDescriptor;return function(c){for(var g=[],h=a(null),i=c;null!==c;){for(var j=p.keys(c),k=0,l=j.length;l>k;++k){var m=j[k];if(!h[m]){h[m]=!0;var n=b(c,m);null==n||"function"!=typeof n.value||d(n.value)||e(i,m)||g.push(m,n.value)}}c=p.getPrototypeOf(c)}return f(g),g}}return function(a){var b=[];for(var c in a){var g=a[c];"function"!=typeof g||d(g)||e(a,c)||b.push(c,g)}return f(b),b}}(),y=/^[a-z$_][a-z$_0-9]*$/i,z=t?k:l;b.promisify=function(a,b){if("object"==typeof a&&null!==a)return u("Promise.promisify for promisifying entire objects is deprecated. Use Promise.promisifyAll instead."),m(a,b,!0);if("function"!=typeof a)throw new v("fn must be a function");return d(a)?a:m(a,arguments.length<2?n:b,!1)},b.promisifyAll=function(a){if("function"!=typeof a&&"object"!=typeof a)throw new v("the target of promisifyAll must be an object or a function");return m(a,void 0,!0)}}},{"./errors":10,"./es5.js":12,"./promise_resolver.js":22,"./util.js":38}],25:[function(a,b){"use strict";b.exports=function(b,c){function d(a,b){for(var c=g.keys(a),d=new Array(c.length),e=0,f=d.length;f>e;++e)d[e]=a[c[e]];if(this.constructor$(d,b),!this._isResolved())for(var e=0,f=c.length;f>e;++e)d.push(c[e])}var e=a("./util.js"),f=e.inherits,g=a("./es5.js");return f(d,c),d.prototype._init=function(){this._init$(void 0,-3)},d.prototype._promiseFulfilled=function(a,b){if(!this._isResolved()){this._values[b]=a;var c=++this._totalResolved;if(c>=this._length){for(var d={},e=this.length(),f=0,g=this.length();g>f;++f)d[this._values[f+e]]=this._values[f];this._resolve(d)}}},d.prototype._promiseProgressed=function(a,b){this._isResolved()||this._promise._progress({key:this._values[b+this.length()],value:a})},c.PropertiesPromiseArray=d,d}},{"./es5.js":12,"./util.js":38}],26:[function(a,b){"use strict";b.exports=function(b,c){function d(a,c){var d,f=b._cast(a,void 0);return h(f)?(f instanceof b?d=f._then(b.props,void 0,void 0,void 0,void 0):(d=new e(f,c===!0&&f._isBound()?f._boundTo:void 0).promise(),c=!1),c===!0&&f._isBound()&&d._setBoundTo(f._boundTo),d):g("cannot await properties of a non-object")}var e=a("./properties_promise_array.js")(b,c),f=a("./util.js"),g=a("./errors_api_rejection")(b),h=f.isObject;b.prototype.props=function(){return d(this,!0)},b.props=function(a){return d(a,!1)}}},{"./errors_api_rejection":11,"./properties_promise_array.js":25,"./util.js":38}],27:[function(a,b){"use strict";function c(a,b,c,d,e){for(var f=0;e>f;++f)c[f+d]=a[f+b]}function d(a){return a>>>=0,a-=1,a|=a>>1,a|=a>>2,a|=a>>4,a|=a>>8,a|=a>>16,a+1}function e(a){return"number"!=typeof a?16:d(Math.min(Math.max(16,a),1073741824))}function f(a){this._capacity=e(a),this._length=0,this._front=0,this._makeCapacity()}f.prototype._willBeOverCapacity=function(a){return this._capacity<a},f.prototype._pushOne=function(a){var b=this.length();this._checkCapacity(b+1);var c=this._front+b&this._capacity-1;this[c]=a,this._length=b+1},f.prototype.push=function(a,b,c){var d=this.length()+3;if(this._willBeOverCapacity(d))return this._pushOne(a),this._pushOne(b),void this._pushOne(c);var e=this._front+d-3;this._checkCapacity(d);var f=this._capacity-1;this[e+0&f]=a,this[e+1&f]=b,this[e+2&f]=c,this._length=d},f.prototype.shift=function(){var a=this._front,b=this[a];return this[a]=void 0,this._front=a+1&this._capacity-1,this._length--,b},f.prototype.length=function(){return this._length},f.prototype._makeCapacity=function(){for(var a=this._capacity,b=0;a>b;++b)this[b]=void 0},f.prototype._checkCapacity=function(a){this._capacity<a&&this._resizeTo(this._capacity<<3)},f.prototype._resizeTo=function(a){var b=this._front,d=this._capacity,e=new Array(d),f=this.length();if(c(this,0,e,0,d),this._capacity=a,this._makeCapacity(),this._front=0,d>=b+f)c(e,b,this,0,f);else{var g=f-(b+f&d-1);c(e,b,this,0,g),c(e,0,this,g,f-g)}},b.exports=f},{}],28:[function(a,b){"use strict";b.exports=function(b,c){function d(a,d){var i=b._cast(a,void 0);if(i instanceof b)return g(i);if(!f(a))return e("expecting an array, a promise or a thenable");var j=new b(c);j._setTrace(d),void 0!==d&&(d._isBound()&&j._setBoundTo(d._boundTo),d._cancellable()&&(j._setCancellable(),j._cancellationParent=d));for(var k=j._fulfill,l=j._reject,m=0,n=a.length;n>m;++m){var o=a[m];(void 0!==o||h.call(a,m))&&b.cast(o)._then(k,l,void 0,j,null)}return j}var e=a("./errors_api_rejection.js")(b),f=a("./util.js").isArray,g=function(a){return a.then(function(b){return d(b,a)})},h={}.hasOwnProperty;b.race=function(a){return d(a,void 0)},b.prototype.race=function(){return d(this,void 0)}}},{"./errors_api_rejection.js":11,"./util.js":38}],29:[function(a,b){"use strict";b.exports=function(a,b,c,d,e){function f(b,c,d,f,g){this.promise=new a(e),this.index=c,this.length=f.length,this.items=f,this.callback=b,this.receiver=g,this.accum=d}function g(a,b){var c=this,d=void 0;"function"!=typeof c&&(d=c.receiver,c=c.fn);var e=a.length,g=void 0,h=0;void 0!==b?(g=b,h=0):(h=1,e>0&&(g=a[0]));var i=h;if(i>=e)return g;var j=new f(c,i,g,a,d);return j.iterate(),j.promise}function h(a){var b=this.fn,c=this.initialValue;return g.call(b,a,c)}function i(a,b,c,d){return c._then(function(c){return j(a,b,c,d)},void 0,void 0,void 0,void 0)}function j(e,f,j,k){if("function"!=typeof f)return d("fn must be a function");if(k===!0&&e._isBound()&&(f={fn:f,receiver:e._boundTo}),void 0!==j){if(j instanceof a){if(!j.isFulfilled())return i(e,f,j,k);j=j._settledValue}return b(e,c,k===!0&&e._isBound()?e._boundTo:void 0).promise()._then(h,void 0,void 0,{fn:f,initialValue:j},void 0)}return b(e,c,k===!0&&e._isBound()?e._boundTo:void 0).promise()._then(g,void 0,void 0,f,void 0)}f.prototype.reject=function(a){this.promise._reject(a)},f.prototype.fulfill=function(a,b){this.accum=a,this.index=b+1,this.iterate()},f.prototype.iterate=function(){for(var b=this.index,c=this.length,d=this.items,e=this.accum,f=this.receiver,g=this.callback;c>b;++b)if(e=g.call(f,e,d[b],b,c),e=a._cast(e,void 0),e instanceof a)return void e._then(this.fulfill,this.reject,void 0,this,b);this.promise._fulfill(e)},a.reduce=function(a,b,c){return j(a,b,c,!1)},a.prototype.reduce=function(a,b){return j(this,a,b,!0)}}},{}],30:[function(a,b){var c,d=a("__browserify_process"),e=a("./global.js");if("undefined"!=typeof d&&null!==d&&"function"==typeof d.cwd&&"function"==typeof d.nextTick&&"string"==typeof d.version)c=function(a){d.nextTick(a)};else if("function"!=typeof e.MutationObserver&&"function"!=typeof e.WebkitMutationObserver&&"function"!=typeof e.WebKitMutationObserver||"undefined"==typeof document||"function"!=typeof document.createElement)if("function"==typeof e.postMessage&&"function"!=typeof e.importScripts&&"function"==typeof e.addEventListener&&"function"==typeof e.removeEventListener){var f="bluebird_message_key_"+Math.random();c=function(){function a(a){if(a.source===e&&a.data===f){var c=b;b=void 0,c()}}var b=void 0;return e.addEventListener("message",a,!1),function(a){b=a,e.postMessage(f,"*")}}()}else c="function"==typeof e.MessageChannel?function(){var a=void 0,b=new e.MessageChannel;return b.port1.onmessage=function(){var b=a;a=void 0,b()},function(c){a=c,b.port2.postMessage(null)}}():e.setTimeout?function(a){setTimeout(a,4)}:function(a){a()};else c=function(){var a=e.MutationObserver||e.WebkitMutationObserver||e.WebKitMutationObserver,b=document.createElement("div"),c=void 0,d=new a(function(){var a=c;c=void 0,a()});return d.observe(b,{attributes:!0}),function(a){c=a,b.setAttribute("class","foo")}}();b.exports=c},{"./global.js":16,__browserify_process:39}],31:[function(a,b){"use strict";b.exports=function(b,c,d){function e(a,b){return c(a,f,b===!0&&a._isBound()?a._boundTo:void 0).promise()}var f=a("./settled_promise_array.js")(b,d);b.settle=function(a){return e(a,!1)},b.prototype.settle=function(){return e(this,!0)}}},{"./settled_promise_array.js":32}],32:[function(a,b){"use strict";b.exports=function(b,c){function d(a,b){this.constructor$(a,b)}var e=b.PromiseInspection,f=a("./util.js"),g=f.inherits;return g(d,c),d.prototype._promiseResolved=function(a,b){this._values[a]=b;var c=++this._totalResolved;c>=this._length&&this._resolve(this._values)},d.prototype._promiseFulfilled=function(a,b){if(!this._isResolved()){var c=new e;c._bitField=268435456,c._settledValue=a,this._promiseResolved(b,c)}},d.prototype._promiseRejected=function(a,b){if(!this._isResolved()){var c=new e;c._bitField=134217728,c._settledValue=a,this._promiseResolved(b,c)}},d}},{"./util.js":38}],33:[function(a,b){"use strict";b.exports=function(b,c,d,e){function f(a,b,d){if((0|b)!==b||0>b)return e("expecting a positive integer");var f=c(a,g,d===!0&&a._isBound()?a._boundTo:void 0),h=f.promise();return h.isRejected()?h:(f.setHowMany(b),f.init(),h)}var g=a("./some_promise_array.js")(d);b.some=function(a,b){return f(a,b,!1)},b.prototype.some=function(a){return f(this,a,!0)}}},{"./some_promise_array.js":34}],34:[function(a,b){"use strict";b.exports=function(b){function c(a,b){this.constructor$(a,b),this._howMany=0,this._unwrap=!1,this._initialized=!1}var d=a("./util.js"),e=a("./errors.js").RangeError,f=d.inherits,g=d.isArray;return f(c,b),c.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-2);var a=g(this._values);if(this._holes=a?this._values.length-this.length():0,!this._isResolved()&&a&&this._howMany>this._canPossiblyFulfill()){var b="(Promise.some) input array contains less than "+this._howMany+" promises";this._reject(new e(b))}}},c.prototype.init=function(){this._initialized=!0,this._init()},c.prototype.setUnwrap=function(){this._unwrap=!0},c.prototype.howMany=function(){return this._howMany},c.prototype.setHowMany=function(a){this._isResolved()||(this._howMany=a)},c.prototype._promiseFulfilled=function(a){this._isResolved()||(this._addFulfilled(a),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),this._resolve(1===this.howMany()&&this._unwrap?this._values[0]:this._values)))},c.prototype._promiseRejected=function(a){this._isResolved()||(this._addRejected(a),this.howMany()>this._canPossiblyFulfill()&&this._reject(this._values.length===this.length()?[]:this._values.slice(this.length()+this._holes)))},c.prototype._fulfilled=function(){return this._totalResolved},c.prototype._rejected=function(){return this._values.length-this.length()-this._holes},c.prototype._addRejected=function(a){this._values.push(a)},c.prototype._addFulfilled=function(a){this._values[this._totalResolved++]=a},c.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},c}},{"./errors.js":10,"./util.js":38}],35:[function(a,b){"use strict";b.exports=function(a){function b(a){void 0!==a?(this._bitField=a._bitField,this._settledValue=a.isResolved()?a._settledValue:void 0):(this._bitField=0,this._settledValue=void 0)}b.prototype.isFulfilled=a.prototype.isFulfilled=function(){return(268435456&this._bitField)>0},b.prototype.isRejected=a.prototype.isRejected=function(){return(134217728&this._bitField)>0},b.prototype.isPending=a.prototype.isPending=function(){return 0===(402653184&this._bitField)},b.prototype.value=a.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise");return this._settledValue},b.prototype.error=a.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise");return this._settledValue},b.prototype.isResolved=a.prototype.isResolved=function(){return(402653184&this._bitField)>0},a.prototype.inspect=function(){return new b(this)},a.PromiseInspection=b}},{}],36:[function(a,b){"use strict";b.exports=function(b,c){function d(a){try{return a.then}catch(b){return j.e=b,j}}function e(a,e){if(k(a)){if(a instanceof b)return a;if(f(a)){var h=new b(c);return h._setTrace(void 0),a._then(h._fulfillUnchecked,h._rejectUncheckedCheckError,h._progressUnchecked,h,null),h._setFollowing(),h}var l=d(a);if(l===j)return void 0!==e&&i(l.e)&&e._attachExtraTrace(l.e),b.reject(l.e);if("function"==typeof l)return g(a,l,e)}return a}function f(a){return l.call(a,"_promise0")}function g(a,c,d){function e(c){if(!j){if(j=!0,a===c){var e=b._makeSelfResolutionError();return void 0!==d&&d._attachExtraTrace(e),void h.promise._reject(e,void 0)}h.resolve(c)}}function f(a){if(!j){j=!0;var b=i(a)?a:new Error(a+"");void 0!==d&&d._attachExtraTrace(b),h.promise._reject(a,b)}}function g(a){if(!j){var b=h.promise;"function"==typeof b._progress&&b._progress(a)}}var h=b.defer(),j=!1;try{c.call(a,e,f,g)}catch(k){if(!j){j=!0;var l=i(k)?k:new Error(k+"");void 0!==d&&d._attachExtraTrace(l),h.promise._reject(k,l)}}return h.promise}var h=a("./util.js"),i=a("./errors.js").canAttach,j=h.errorObj,k=h.isObject,l={}.hasOwnProperty;b._cast=e}},{"./errors.js":10,"./util.js":38}],37:[function(a,b){"use strict";var c=a("./global.js"),d=function(a,b){for(var d=arguments.length,e=new Array(d-2),f=2;d>f;++f)e[f-2]=arguments[f];c.setTimeout(function(){a.apply(void 0,e)},b)};b.exports=function(b,c){var e=(a("./util.js"),a("./errors.js")),f=(a("./errors_api_rejection")(b),b.TimeoutError),g=function(a,b,c){if(a.isPending()){"string"!=typeof b&&(b="operation timed out after "+c+" ms");var d=new f(b);e.markAsOriginatingFromRejection(d),a._attachExtraTrace(d),a._rejectUnchecked(d)}},h=function(a,b){b._fulfill(a)},i=b.delay=function(a,e){void 0===e&&(e=a,a=void 0),e=+e;var f=b._cast(a,void 0),g=new b(c);return f instanceof b?(f._isBound()&&g._setBoundTo(f._boundTo),f._cancellable()&&(g._setCancellable(),g._cancellationParent=f),g._setTrace(f),g._follow(f),g.then(function(a){return b.delay(a,e)})):(g._setTrace(void 0),d(h,e,a,g),g)};b.prototype.delay=function(a){return i(this,a)},b.prototype.timeout=function(a,e){a=+a;var f=new b(c);return f._setTrace(this),this._isBound()&&f._setBoundTo(this._boundTo),this._cancellable()&&(f._setCancellable(),f._cancellationParent=this),f._follow(this),d(g,a,f,e,a),f}}},{"./errors.js":10,"./errors_api_rejection":11,"./global.js":16,"./util.js":38}],38:[function(a,b,c){"use strict";function d(a){"undefined"!=typeof console&&null!==console&&"function"==typeof console.warn&&console.warn("Bluebird: "+a)}function e(a,b,c){try{return a.call(b,c)}catch(d){return t.e=d,t}}function f(a,b,c,d){try{return a.call(b,c,d)}catch(e){return t.e=e,t}}function g(a,b,c){try{return a.apply(c,b)}catch(d){return t.e=d,t}}function h(a){return"string"==typeof a?a:""+a}function i(a){return null==a||a===!0||a===!1||"string"==typeof a||"number"==typeof a}function j(a){return!i(a)}function k(a){return i(a)?new Error(h(a)):a}function l(a,b){var c,d=a.length,e=new Array(d+1);for(c=0;d>c;++c)e[c]=a[c];return e[c]=b,e}function m(a,b,c){if(i(a))return a;var d={value:c,configurable:!0,enumerable:!1,writable:!0};return q.defineProperty(a,b,d),a}function n(a){throw a}function o(a){function b(){}return b.prototype=a,b}var p=a("./global.js"),q=a("./es5.js"),r=function(){try{var a={};return q.defineProperty(a,"f",{get:function(){return 3}}),3===a.f}catch(b){return!1}}(),s=function(){return"undefined"!=typeof window&&null!==window&&"undefined"!=typeof window.document&&"undefined"!=typeof navigator&&null!==navigator&&"string"==typeof navigator.appName&&window===p?!1:!0}(),t={e:{}},u=function(a,b){function c(){this.constructor=a,this.constructor$=b;for(var c in b.prototype)d.call(b.prototype,c)&&"$"!==c.charAt(c.length-1)&&(this[c+"$"]=b.prototype[c])}var d={}.hasOwnProperty;return c.prototype=b.prototype,a.prototype=new c,a.prototype},v=function(){return"string"!==this}.call("string"),w={thrower:n,isArray:q.isArray,haveGetters:r,notEnumerableProp:m,isPrimitive:i,isObject:j,canEvaluate:s,deprecated:d,errorObj:t,tryCatch1:e,tryCatch2:f,tryCatchApply:g,inherits:u,withAppended:l,asString:h,maybeWrapAsError:k,wrapsPrimitiveReceiver:v,toFastProperties:o};b.exports=w},{"./es5.js":12,"./global.js":16}],39:[function(a,b){var c=b.exports={};c.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};if(b){var c=[];return window.addEventListener("message",function(a){var b=a.source;if((b===window||null===b)&&"process-tick"===a.data&&(a.stopPropagation(),c.length>0)){var d=c.shift();d()}},!0),function(a){c.push(a),window.postMessage("process-tick","*")}}return function(a){setTimeout(a,0)}}(),c.title="browser",c.browser=!0,c.env={},c.argv=[],c.binding=function(){throw new Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(){throw new Error("process.chdir is not supported")}},{}],40:[function(a,b){function c(a){if(!a||"[object Object]"!==e.call(a)||a.nodeType||a.setInterval)return!1;var b=d.call(a,"constructor"),c=d.call(a.constructor.prototype,"isPrototypeOf");if(a.constructor&&!b&&!c)return!1;var f;for(f in a);return void 0===f||d.call(a,f)}var d=Object.prototype.hasOwnProperty,e=Object.prototype.toString;b.exports=function f(){var a,b,d,e,g,h,i=arguments[0]||{},j=1,k=arguments.length,l=!1;for("boolean"==typeof i&&(l=i,i=arguments[1]||{},j=2),"object"!=typeof i&&"function"!=typeof i&&(i={});k>j;j++)if(null!=(a=arguments[j]))for(b in a)d=i[b],e=a[b],i!==e&&(l&&e&&(c(e)||(g=Array.isArray(e)))?(g?(g=!1,h=d&&Array.isArray(d)?d:[]):h=d&&c(d)?d:{},i[b]=f(l,h,e)):void 0!==e&&(i[b]=e));return i}},{}],41:[function(a,b){function c(a){var b=this;if(!(b instanceof c))throw new Error("usage: new Hoodie(url);");b.baseUrl=a?a.replace(/\/+$/,""):"",b.checkConnectionInterval=3e3,b.extend=function(a){a(b,o,p)},b.extend(n),b.extend(h),b.extend(l),b.extend(j),b.extend(k),b.extend(f),b.extend(g),b.extend(i),b.extend(m),b.on("account:cleanup",p.config.clear),b.id.init(),b.account.username=p.config.get("_account.username"),b.remote.init(),b.account.checkPasswordReset(),b.store.bootstrapDirtyObjects(),b.account.subscribeToOutsideEvents(),b.id.subscribeToOutsideEvents(),b.store.subscribeToOutsideEvents(),b.remote.subscribeToOutsideEvents(),b.task.subscribeToOutsideEvents(),b.account.authenticate().then(function(){b.remote.connect()}),e.addEventListener("online",b.checkConnection,!1),e.addEventListener("offline",b.checkConnection,!1),b.checkConnection(),d(b)}function d(a){for(var b=0;b<q.length;b++)q[b](a,o,p)}var e="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},f=a("./hoodie/account"),g=a("./hoodie/remote"),h=a("./hoodie/connection"),i=a("./hoodie/id"),j=a("./hoodie/store"),k=a("./hoodie/task"),l=a("./hoodie/open"),m=a("./hoodie/request"),n=a("./lib/events"),o=a("./lib"),p=a("./utils/"),q=[];c.extend=function(a){q.push(a)},b.exports=c},{"./hoodie/account":42,"./hoodie/connection":43,"./hoodie/id":44,"./hoodie/open":45,"./hoodie/remote":46,"./hoodie/request":47,"./hoodie/store":48,"./hoodie/task":49,"./lib":55,"./lib/events":54,"./utils/":65}],42:[function(a,b){function c(a){function b(a){return h.set($,a)}function c(){return h.get($)}function n(){return h.unset($)}function o(){var b=a.id(),d=c();return W.signIn(b,d).done(function(){W.trigger("signin:anonymous",b)})}function p(){a.on("remote:error:unauthenticated",q)}function q(){return V=void 0,W.authenticate()}function r(a){return W.username!==a?(W.username=a,h.set("_account.username",a)):void 0}function s(a){return a.userCtx.name?(V=!0,m(W.username)):W.hasAnonymousAccount()?o():(V=!1,W.trigger("error:unauthenticated"),j())}function t(a,b){return function(c){return X._rev=c.rev,v(a,b,{moveData:!0})}}function u(a){return function(b){return"HoodieConflictError"===b.name&&(b.message="Username "+a+" already exists"),l(b)}}function v(a,b,c,e){return e||(e=i()),d.setTimeout(function(){var d=S(a,b,c);d.done(e.resolve),d.fail(function(d){"HoodieAccountUnconfirmedError"===d.name?v(a,b,c,e):e.reject.apply(e,arguments)})},300),e.promise()}function w(a){return a=a||{},function(b){var c,d;return c=b.name.replace(/^user(_anonymous)?\//,""),d=b.roles[0],-1!==b.roles.indexOf("error")?W.fetch(c).then(function(){return l(X.$error)}):-1===b.roles.indexOf("confirmed")?l({name:"HoodieAccountUnconfirmedError",message:"Account has not been confirmed yet"}):(V=!0,W.fetch(),m(c,d,a))}}function x(a){var b;return a.$error?(b=a.$error,b.object=a,delete b.object.$error):b={name:"HoodiePendingError",message:"Password reset is still pending"},l(b)}function y(a){return function(b){return"HoodieUnauthorizedError"===b.name?(h.unset("_account.resetPasswordId"),W.trigger("passwordreset",a),k()):l(b)}}function z(){var a=i();return W.one("passwordreset",a.resolve),W.on("error:passwordreset",A),W.on("error:passwordreset",a.reject),a.always(function(){W.unbind("passwordreset",a.resolve),W.unbind("error:passwordreset",A),W.unbind("error:passwordreset",a.reject)}),a.promise()}function A(a){var b=a.object,c=b.name,d=c.substr(15),e="/_users/"+encodeURIComponent(Z+":"+c),f=btoa(c+":"+d);b._deleted=!0;var g={headers:{Authorization:"Basic "+f},contentType:"application/json",data:JSON.stringify(b)};W.request("PUT",e,g),h.unset("_account.resetPasswordId")}function B(b,c,d){var e=W.hasAnonymousAccount()?a.id():W.username;return S(e,b).then(function(){return W.fetch().then(L(b,c,d))})}function C(a,b){var d=c();return B(d,a,b).done(function(){W.trigger("signup",a),n()})}function D(){return G(),X._deleted=!0,O("updateUsersDoc",function(){W.request("PUT",K(),{data:JSON.stringify(X),contentType:"application/json"})})}function E(a){return"HoodieNotFoundError"===a.name?k():l(a)}function F(){return W.trigger("cleanup"),V=void 0,r(void 0),k()
}function G(){return a.remote.disconnect()}function H(){var a=W.username;return F().then(function(){return W.trigger("signout",a)})}function I(b){var c;return c=b===a.id()?"user_anonymous":"user",""+c+"/"+b}function J(b){var c=W.hasAnonymousAccount()?a.id():W.username;return b=b||c,""+Z+":"+I(b)}function K(a){return"/_users/"+encodeURIComponent(J(a))}function L(a,b,c){return function(){var d=f({},X);b&&(d.$newUsername=b),d.updatedAt=U(),d.signedUpAt=d.signedUpAt||U(),void 0!==c&&(delete d.salt,delete d.password_sha,d.password=c);var e={data:JSON.stringify(d),contentType:"application/json"};return O("updateUsersDoc",function(){return W.request("PUT",K(),e).then(M(b,c||a))})}}function M(b,c){var d=W.hasAnonymousAccount()?a.id():W.username;return function(){return G(),b?N(d,c).then(function(){return W.signOut({silent:!0,ignoreLocalChanges:!0}).then(function(){return W.signIn(b,c,{moveData:!0})})}):W.signIn(d,c)}}function N(a,b,c){c||(c=i());var e={data:{name:I(a),password:b}};return O("signIn",function(){return W.request("POST","/_session",e)}).done(function(){d.setTimeout(N,300,a,b,c)}).fail(function(a){return 401===a.status?c.resolve():void c.reject(a)}),c.promise()}function O(a,b){return void 0!==Y[a]&&"function"==typeof Y[a].abort&&Y[a].abort(),Y[a]=b(),Y[a]}function P(a,b){return void 0!==Y[a]&&"function"==typeof Y[a].state&&"pending"===Y[a].state()?Y[a]:(Y[a]=b(),Y[a])}function Q(b){return a.store.hasLocalChanges()&&!b.ignoreLocalChanges?a.remote.push():k()}function R(){return P("signOut",function(){return W.request("DELETE","/_session")})}function S(a,b,c){var d={data:{name:I(a),password:b}};return O("signIn",function(){var a=W.request("POST","/_session",d);return a.then(w(c))})}function T(b,c){var d,e=i();return b=b.toLowerCase(),d={data:JSON.stringify({_id:J(b),name:I(b),type:"user",roles:[],password:c,hoodieId:a.id(),database:W.db(),updatedAt:U(),createdAt:U(),signedUpAt:b!==a.id()?U():void 0}),contentType:"application/json"},W.request("PUT",K(b),d).done(e.notify).then(t(b,c),u(b)).then(e.resolve,e.reject),e.promise()}function U(){return new Date}var V,W={},X={},Y={},Z="org.couchdb.user";e(a,{context:W,namespace:"account"}),W.authenticate=function(){var a;return V===!1?j():V===!0?m(W.username):Y.signOut&&"pending"===Y.signOut.state()?Y.signOut.then(j):Y.signIn&&"pending"===Y.signIn.state()?Y.signIn:W.hasAccount()?(a=function(){return W.request("GET","/_session").then(s)},P("authenticate",a)):R().then(function(){return V=!1,j()})},W.hasValidSession=function(){return W.hasAccount()?V===!0:!1},W.hasInvalidSession=function(){return W.hasAccount()?V===!1:!1},W.signUp=function(a,b){return void 0===b&&(b=""),a?W.hasAnonymousAccount()?C(a,b):W.hasAccount()?l("Must sign out first."):T(a,b).done(function(){W.trigger("signup",a)}):l("Username must be set.")},W.anonymousSignUp=function(){var c,d;return c=g(10),d=a.id(),T(d,c).progress(function(){b(c)}).done(function(){W.trigger("signup:anonymous")})},W.hasAccount=function(){var a=!!W.username;return a||W.hasAnonymousAccount()},W.hasAnonymousAccount=function(){return!!c()};var $="_account.anonymousPassword";W.signIn=function(a,b,c){var d,e,f=a===W.username;return a||(a=""),b||(b=""),a=a.toLowerCase(),c=c||{},d=c.silent,e=!W.hasAccount()||f||c.moveData?S(a,b,c):Q(c).then(function(){return S(a,b,c)}),f||e.done(G),e.done(function(a,b){c.moveData&&(d||W.trigger("movedata")),f||F(),f?d||W.trigger("reauthenticated",a):r(a),d||W.trigger("signin",a,b,c)})},W.signOut=function(a){var b;return a=a||{},b=a.silent?F:H,W.hasAccount()?Q(a).then(G).then(R).then(b):b()},W.request=function(b,c,d){return d=d||{},a.request.apply(a,arguments)},W.db=function(){return"user/"+a.id()},W.fetch=function(b){var c=W.hasAnonymousAccount()?a.id():W.username;return void 0===b&&(b=c),b?P("fetch",function(){return W.request("GET",K(b)).done(function(a){return X=a})}):l({name:"HoodieUnauthorizedError",message:"Not signed in"})},W.changePassword=function(a,b){return W.username?(G(),W.fetch().then(L(a,null,b)).done(function(){W.trigger("changepassword")})):l({name:"HoodieUnauthorizedError",message:"Not signed in"})},W.resetPassword=function(a){var b,c,d,e;return(e=h.get("_account.resetPasswordId"))?W.checkPasswordReset():(e=""+a+"/"+g(),h.set("_account.resetPasswordId",e),c=""+Z+":$passwordReset/"+e,b={_id:c,name:"$passwordReset/"+e,type:"user",roles:[],password:e,createdAt:U(),updatedAt:U()},d={data:JSON.stringify(b),contentType:"application/json"},O("resetPassword",function(){return W.request("PUT","/_users/"+encodeURIComponent(c),d).done(W.checkPasswordReset).then(z).done(function(){W.trigger("resetpassword")})}))},W.checkPasswordReset=function(){var a,b,c,e,f,g;return(c=h.get("_account.resetPasswordId"))?(f=c.split("/")[0],g="$passwordReset/"+c,e="/_users/"+encodeURIComponent(Z+":"+g),a=btoa(g+":"+c),b={headers:{Authorization:"Basic "+a}},P("passwordResetStatus",function(){return W.request("GET",e,b).then(x,y(f)).fail(function(a){return"HoodiePendingError"===a.name?void d.setTimeout(W.checkPasswordReset,1e3):W.trigger("error:passwordreset",a,f)})})):l("No pending password reset.")},W.changeUsername=function(b,c){var d=W.hasAnonymousAccount()?a.id():W.username;return c!==d?(c=c||"",B(b,c.toLowerCase()).done(function(){r(c),W.trigger("changeusername",c)})):l({name:"HoodieConflictError",message:"Usernames identical"})},W.destroy=function(){return W.hasAccount()?W.fetch().then(D,E).then(H):H()},W.subscribeToOutsideEvents=function(){p(),delete W.subscribeToOutsideEvents},a.account=W}var d="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e=a("../lib/events"),f=a("extend"),g=a("../utils/generate_id"),h=a("../utils/config"),i=a("../utils/promise/defer"),j=a("../utils/promise/reject"),k=a("../utils/promise/resolve"),l=a("../utils/promise/reject_with"),m=a("../utils/promise/resolve_with");b.exports=c},{"../lib/events":54,"../utils/config":62,"../utils/generate_id":63,"../utils/promise/defer":67,"../utils/promise/reject":70,"../utils/promise/reject_with":71,"../utils/promise/resolve":72,"../utils/promise/resolve_with":73,extend:40}],43:[function(a,b,c){var d="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e=a("../utils/");b.exports=function(a){var b=!0,f=null,g=null;a.checkConnection=function(){var b=f,e="/?hoodieId="+a.id();return b&&"pending"===b.state()?b:(d.clearTimeout(g),f=a.request("GET",e).then(c.handleCheckConnectionSuccess,c.handleCheckConnectionError))},a.isConnected=function(){return b},c.handleCheckConnectionSuccess=e.toPromise(function(c){return a.checkConnectionInterval=3e4,g=d.setTimeout(a.checkConnection,a.checkConnectionInterval),a.isConnected()||(a.trigger("reconnected"),b=!0),c()}),c.handleCheckConnectionError=e.toPromise(function(c){return a.checkConnectionInterval=3e3,g=d.setTimeout(a.checkConnection,a.checkConnectionInterval),a.isConnected()&&(a.trigger("disconnected"),b=!1),c()})}},{"../utils/":65}],44:[function(a,b){var c=a("../utils/generate_id"),d=a("../utils/config");b.exports=function(a){function b(){return i||e(c()),i}function e(a){i=a,d.set("_hoodieId",a)}function f(){i=void 0,d.unset("_hoodieId")}function g(){i=d.get("_hoodieId"),i||(i=d.get("_account.ownerHash"))}function h(){a.on("account:cleanup",f),a.on("account:signin",function(a,b){e(b)}),a.on("account:signin:anonymous",e)}var i;b.init=function(){g(),delete b.init},b.subscribeToOutsideEvents=function(){h(),delete b.subscribeToOutsideEvents},a.id=b}},{"../utils/config":62,"../utils/generate_id":63}],45:[function(a,b){var c=a("../lib/store/remote"),d=a("extend");b.exports=function(a){function b(b,e){return e=e||{},d(e,{name:b}),c(a,e)}a.open=b}},{"../lib/store/remote":58,extend:40}],46:[function(a,b){function c(a){function b(a){return a?d.set("_remote.since",a):d.get("_remote.since")||0}function c(){a.on("remote:connect",function(){a.on("store:idle",f.push)}),a.on("remote:disconnect",function(){a.unbind("store:idle",f.push)}),a.on("disconnected",f.disconnect),a.on("reconnected",f.connect),a.on("account:signup",f.connect),a.on("account:signup:anonymous",f.connect),a.on("account:signin",f.connect),a.on("account:signin:anonymous",f.connect),a.on("account:reauthenticated",f.connect),a.on("account:signout",f.disconnect)}var f=a.open(a.account.db(),{connected:!0,prefix:"",since:b,defaultObjectsToPush:a.store.changedObjects,knownObjects:a.store.index().map(function(a){var b=a.split(/\//);return{type:b[0],id:b[1]}})}),g=f.connect;f.connect=e.toPromise(function(b){return a.account.hasAccount()?g(a.account.db()):b("User has no database to connect to")}),f.trigger=function(){var b;b=arguments[0];var c=2<=arguments.length?Array.prototype.slice.call(arguments,1):[];return a.trigger.apply(a,["remote:"+b].concat(Array.prototype.slice.call(c)))},f.on=function(b,c){return b=b.replace(/(^| )([^ ]+)/g,"$1remote:$2"),a.on(b,c)},f.unbind=function(b,c){return b=b.replace(/(^| )([^ ]+)/g,"$1remote:$2"),a.unbind(b,c)},f.subscribeToOutsideEvents=function(){c(),delete f.subscribeToOutsideEvents},a.remote=f}var d=a("../utils/config"),e=a("../utils/");b.exports=function(a){var b=function(){c(a)};a.remote={init:b}}},{"../utils/":65,"../utils/config":62}],47:[function(a,b){function c(a){function b(b,d,f){var g,j,k;return f=f||{},g={type:b,dataType:"json"},/^http/.test(d)||(d=(a.baseUrl||"")+i+d),/^http/.test(d)&&(g.xhrFields={withCredentials:!0},g.crossDomain=!0),g.url=d,j=h(e(g,f)),k=j.then(null,c),k.abort=j.abort,k}function c(b){var c;try{c=g(b)}catch(d){c=b.responseText?b.responseText:{name:"HoodieConnectionError",message:"Could not connect to Hoodie server at {{url}}.",url:a.baseUrl||"/"}}return f(c).promise()}function g(a){var b=JSON.parse(a.responseText);return b.name=j[a.status],b.name||(b.name=d(b.error)),b.status=a.status,b.message=b.reason||"",b.message=b.message.charAt(0).toUpperCase()+b.message.slice(1),delete b.error,delete b.reason,b}var h=$.ajax,i="/_api",j={400:"HoodieRequestError",401:"HoodieUnauthorizedError",403:"HoodieRequestError",404:"HoodieNotFoundError",409:"HoodieConflictError",412:"HoodieConflictError",500:"HoodieServerError"};a.request=b}var d=a("../utils/hoodiefy_request_error_name"),e=a("extend"),f=a("../utils/promise/reject_with");b.exports=c},{"../utils/hoodiefy_request_error_name":64,"../utils/promise/reject_with":71,extend:40}],48:[function(a,b,c){var d="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e=a("../lib/store/api"),f=a("../lib/error/object_type"),g=a("../lib/error/object_id"),h=a("../utils/generate_id"),i=a("../utils/config"),j=a("extend"),k=a("../utils/"),l=a("../utils/local_storage_wrapper");b.exports=function(a){function b(a){if(f.isInvalid(a.type))return new f({type:a.type});if(a.id)return g.isInvalid(a.id)?new g({id:a.id}):void 0}function m(a,b,c,d){var e,f;if(void 0===c&&(c=!1),d=d||{},e=""+a+"/"+b,c){if(j(c,{type:a,id:b}),f=j({},c),delete f.type,delete f.id,l.setObject(e,f),d.remote)return q(a,b),G[e]=j(!0,{},c),G[e]}else{if(G[e]===!1)return!1;if(G[e])return j(!0,{},G[e]);if(e=""+a+"/"+b,c=l.getObject(e),!c)return q(a,b),G[e]=!1,!1;c.type=a,c.id=b}return y(c)?(p(a,b,c,d),G[e]=!1,!1):(G[e]=j(!0,{},c),x(c)?p(a,b,G[e],d):q(a,b),j(!0,{},c))}function n(){var a,b,c,d,e,f,g;if(b=l.getItem("_dirty"))for(b=b.split(","),e=0,f=b.length;f>e;e++)g=b[e].split("/"),d=g[0],a=g[1],c=m(d,a)}function o(){a.on("account:signup",r),a.on("account:movedata",E),a.on("account:cleanup",K.clear),a.on("remote:bootstrap:start",B),a.on("remote:bootstrap:end",C),a.on("remote:bootstrap:error",D),a.on("remote:change",s),a.on("remote:push",t)}function p(a,b,c,d){var e;d=d||{},e=""+a+"/"+b,H[e]=c,u(),d.silent||A()}function q(a,b){var c;return a&&b?(c=""+a+"/"+b,delete H[c]):H={},u(),d.clearTimeout(M)}function r(){return K.findAll().pipe(function(a){var b,c,d,e;for(d=0,e=a.length;e>d;d++)c=a[d],b=""+c.type+"/"+c.id,H[b]=c;u(),A()})}function s(a,b){"remove"===a?K.remove(b.type,b.id,{remote:!0,update:b}):K.save(b.type,b.id,b,{remote:!0})}function t(a){z("sync",a),a._deleted?K.remove(a.type,a.id,{remote:!0,silent:!0}):K.save(a.type,a.id,a,{remote:!0,silent:!0})}function u(){try{if($.isEmptyObject(H))l.removeItem("_dirty");else{var a=Object.keys(H);l.setItem("_dirty",a.join(","))}}catch(b){}}function v(){return JSON.stringify(new Date).replace(/['"]/g,"")}function w(a){return N.test(a)}function x(a){return a.updatedAt?a._syncedAt?a._syncedAt<a.updatedAt:!0:!1}function y(a){return a._deleted===!0}function z(a,b,c){K.trigger(a,j(!0,{},b),c),K.trigger(b.type+":"+a,j(!0,{},b),c),K.trigger(a+":"+b.type,j(!0,{},b),c),"new"!==a&&(K.trigger(b.type+":"+b.id+":"+a,j(!0,{},b),c),K.trigger(a+":"+b.type+":"+b.id,j(!0,{},b),c)),"sync"!==a&&(K.trigger("change",a,j(!0,{},b),c),K.trigger(b.type+":change",a,j(!0,{},b),c),K.trigger("change:"+b.type,a,j(!0,{},b),c),"new"!==a&&(K.trigger(b.type+":"+b.id+":change",a,j(!0,{},b),c),K.trigger("change:"+b.type+":"+b.id,a,j(!0,{},b),c)))}function A(){K.trigger("dirty"),d.clearTimeout(M),M=d.setTimeout(function(){K.trigger("idle",K.changedObjects())},J)}function B(){L=!0,K.trigger("bootstrap:start")}function C(){var a,b,c,d;for(L=!1;I.length>0;)a=I.shift(),b=a[0],c=a[1],d=a[2],F[b].apply(F,c).then(d.resolve,d.reject);K.trigger("bootstrap:end")}function D(a){var b,c;for(L=!1;I.length>0;)b=I.shift(),c=b[2],c.reject(a);K.trigger("bootstrap:error",a)}function E(){var b,c,d=[];K.findAll().done(function(e){d=e,c=a.id(),b=i.get(),a.one("signin",function(a,e){for(var f in b)b.hasOwnProperty(f)&&"_account.username"!==f&&"_hoodieId"!==f&&i.set(f,b[f]);d.forEach(function(a){a.createdBy===c&&(a.createdBy=e),K.add(a.type,a)})})})}var F={},G={},H={},I=[],J=2e3;F.save=k.toPromise(function(b,d,e){var f,g,i,j;if(d=d||{},K.isBootstrapping()&&!d.remote)return c.enqueue("save",arguments);if(b.id?(f=m(b.type,b.id),i="object"!=typeof f):(i=!0,b.id=h()),i?b.createdBy=b.createdBy||a.id():f.createdBy&&(b.createdBy=f.createdBy),!i)for(j in f)if(!b.hasOwnProperty(j))switch(j.charAt(0)){case"_":d.remote&&(b[j]=f[j]);break;case"$":d.remote||(b[j]=f[j])}d.remote?b._syncedAt=v():d.silent||(b.updatedAt=v(),b.createdAt=b.createdAt||b.updatedAt),d.local?b._$local=!0:delete b._$local;try{b=m(b.type,b.id,b,d),g=i?"add":"update",e(b,i),d.silent||z(g,b,d)}catch(k){return e(k)}}),F.find=k.toPromise(function(a,b,d){var e;if(K.isBootstrapping())return c.enqueue("find",arguments);try{return e=m(a,b),d(e?e:{name:"HoodieNotFoundError",message:'"{{type}}" with id "{{id}}" could not be found'})}catch(f){return d(f)}}),F.findAll=k.toPromise(function(a,b){var d,e,f,g,h,i,j;if(null==a&&(a=function(){return!0}),K.isBootstrapping())return c.enqueue("findAll",arguments);g=K.index(),"string"==typeof a&&(j=a,a=function(a){return a.type===j});try{return i=function(){var b,c,i,j;for(j=[],b=0,c=g.length;c>b;b++)f=g[b],w(f)&&(i=f.split("/"),d=i[0],e=i[1],h=m(d,e),h&&a(h)&&j.push(h));return j}.call(this),i.sort(function(a,b){return a.createdAt>b.createdAt?-1:a.createdAt<b.createdAt?1:0}),b(i)}catch(k){return b(k)}}),F.remove=k.toPromise(function(a,b,d,e){var f,g,h;return d=d||{},K.isBootstrapping()&&!d.remote?c.enqueue("remove",arguments):(f=a+"/"+b,g=m(a,b),d.remote&&(l.removeItem(f),h=G[f]&&y(G[f]),G[f]=!1,q(a,b),h&&g)?e(g):g?(g._syncedAt?(g._deleted=!0,m(a,b,g)):(f=a+"/"+b,l.removeItem(f),G[f]=!1,q(a,b)),d.update&&(g=d.update,delete d.update),z("remove",g,d),e(g)):e({name:"HoodieNotFoundError",message:'"{{type}}" with id "{{id}}"" could not be found'}))}),F.removeAll=k.toPromise(function(a,b){return K.findAll(a).then(function(a){var c,d,e,f;for(f=[],d=0,e=a.length;e>d;d++)c=a[d],f.push(K.remove(c.type,c.id,b));return f})});var K=e(a,{validate:b,backend:{save:F.save,find:F.find,findAll:F.findAll,remove:F.remove,removeAll:F.removeAll}});K.index=function(){var a,b,c,d,e;for(c=[],a=d=0,e=l.length();e>=0?e>d:d>e;a=e>=0?++d:--d)b=l.key(a),w(b)&&c.push(b);return c},K.changedObjects=function(){var a,b,c,d,e,f,g;e=H,g=[];for(b in e)e.hasOwnProperty(b)&&(c=e[b],f=b.split("/"),d=f[0],a=f[1],c.type=d,c.id=a,g.push(c));return g},K.hasLocalChanges=function(a,b){if(!a)return!$.isEmptyObject(H);var c=[a,b].join("/");return H[c]?!0:x(m(a,b))},K.clear=k.toPromise(function(a){var b,c,d;try{return c=K.index(),d=function(){var a,d,e;for(e=[],a=0,d=c.length;d>a;a++)b=c[a],w(b)&&e.push(l.removeItem(b));return e}.call(this),G={},q(),K.trigger("clear"),a()}catch(e){return a(e)}});var L=!1;K.isBootstrapping=function(){return L},K.isPersistent=function(){return l.isPersistent},K.subscribeToOutsideEvents=function(){o(),delete K.subscribeToOutsideEvents};var M,N=new RegExp(/^[a-z$][a-z0-9]+\/[a-z0-9]+$/);c.enqueue=k.toPromise(function(a,b,c){return I.push([a,b]),c()}),a.store=K,K.bootstrapDirtyObjects=function(){n(),delete K.bootstrapDirtyObjects}}},{"../lib/error/object_id":52,"../lib/error/object_type":53,"../lib/store/api":56,"../utils/":65,"../utils/config":62,"../utils/generate_id":63,"../utils/local_storage_wrapper":66,extend:40}],49:[function(a,b,c){var d=a("../lib/events"),e=a("../lib/task/scoped"),f=a("../lib/error/error"),g=a("extend"),h=a("../utils/");b.exports=function(a){function b(){a.on("store:change",i)}function i(a,b,c){"$"===b.type[0]&&(b.type=b.type.substr(1),m(a,b,c))}function j(b){var c,d="$";return b&&(d+=b),c=function(a){return 0===a.type.indexOf(d)},a.store.findAll(c)}function k(a){return a.map(function(a){return o.abort(a.type.substr(1),a.id)})}function l(a,b){return a.map(function(a){return o.restart(a.type.substr(1),a.id,b)})}function m(a,b,c){var d;return"add"===a&&(a="start"),"remove"===a&&b.abortedAt&&(a="abort"),"remove"===a&&b.$processedAt&&!b.$error&&(a="success"),"update"===a&&b.$error?(a="error",d=b.$error,delete b.$error,o.trigger("error",d,b,c),o.trigger(b.type+":error",d,b,c),o.trigger(b.type+":"+b.id+":error",d,b,c),c=g({},c,{error:d}),o.trigger("change","error",b,c),o.trigger(b.type+":change","error",b,c),void o.trigger(b.type+":"+b.id+":change","error",b,c)):void(("start"===a||"abort"===a||"success"===a)&&(o.trigger(a,b,c),o.trigger(b.type+":"+a,b,c),"start"!==a&&o.trigger(b.type+":"+b.id+":"+a,b,c),o.trigger("change",a,b,c),o.trigger(b.type+":change",a,b,c),"start"!==a&&o.trigger(b.type+":"+b.id+":change",a,b,c)))}function n(){return JSON.stringify(new Date).replace(/['"]/g,"")}var o=function p(b,c){return e(a,p,{type:b,id:c})};d(a,{context:o,namespace:"task"}),o.start=function(b,d){return a.account.hasAccount()?a.store.add("$"+b,d).then(c.handleNewTask):a.account.anonymousSignUp().then(function(){return o.start(b,d)})},o.abort=function(b,d){return a.store.update("$"+b,d,{abortedAt:n()}).then(c.handleAbortedTaskObject)},o.restart=function(a,b,c){var d=function(a){return g(a,c),delete a.$error,delete a.$processedAt,delete a.abortedAt,o.start(a.type,a)};return o.abort(a,b).then(d)},o.abortAll=function(a){return j(a).then(k)},o.restartAll=function(a,b){return"object"==typeof a&&(b=a),j(a).then(function(a){l(a,b)})},o.subscribeToOutsideEvents=function(){b(),delete o.subscribeToOutsideEvents},c.handleNewTask=h.toPromise(function(b,c){var d=a.store(b.type,b.id);return d.on("remove",function(a){return a.type=a.type.substr(1),a.$processedAt?c(a):void c(new f({message:"Task has been aborted",task:a}))}),d.on("update",function(b){var d=b.$error;if(b.$error)return b.type=b.type.substr(1),delete b.$error,d.object=b,d.message=d.message||"Something went wrong",a.store.remove("$"+b.type,b.id),c(new f(d))}),c()}),c.handleAbortedTaskObject=h.toPromise(function(b,c){var d=b.type,e=b.id,f=a.store.remove(d,e);return b._rev?(a.one("store:sync:"+d+":"+e,c()),f.fail(c),c()):f}),a.task=o}},{"../lib/error/error":50,"../lib/events":54,"../lib/task/scoped":61,"../utils/":65,extend:40}],50:[function(a,b){function c(a){"string"==typeof a&&(a={message:a}),a.message||(a.message="Something went wrong"),a.name||(a.name="HoodieError"),a.message=a.message.replace(d,function(b){var c=b.match(e)[0];return a[c]}),f(this,a)}var d=/\{\{\s*\w+\s*\}\}/g,e=/\w+/,f=a("extend");c.prototype=new Error,c.prototype.constructor=c,b.exports=c},{extend:40}],51:[function(a,b){b.exports={error:a("./error"),objectId:a("./object_id"),objectType:a("./object_type")}},{"./error":50,"./object_id":52,"./object_type":53}],52:[function(a,b){function c(a){return a.name="HoodieObjectIdError",a.message='"{{id}}" is invalid object id. {{rules}}.',new d(a)}var d=a("./error"),e=/^[a-z0-9\-]+$/;c.isInvalid=function(a,b){return!(b||e).test(a||"")},c.isValid=function(a,b){return(b||e).test(a||"")},c.prototype.rules="Lowercase letters, numbers and dashes allowed only. Must start with a letter",b.exports=c},{"./error":50}],53:[function(a,b){function c(a){return a.name="HoodieObjectTypeError",a.message='"{{type}}" is invalid object type. {{rules}}.',new d(a)}var d=a("./error"),e=/^[a-z$][a-z0-9]+$/;c.isInvalid=function(a,b){return!(b||e).test(a||"")},c.isValid=function(a,b){return(b||e).test(a||"")},c.prototype.rules="lowercase letters, numbers and dashes allowed only. Must start with a letter",b.exports=c},{"./error":50}],54:[function(a,b){b.exports=function(a,b){function c(b,c){var d,e,f,g;for(d=b.split(" "),f=0,g=d.length;g>f;f++)e=h+d[f],a.eventsCallbacks[e]=a.eventsCallbacks[e]||[],a.eventsCallbacks[e].push(c)}function d(b,c){b=h+b;var d=function(){a.unbind(b,d),c.apply(null,arguments)};a.bind(b,d)}function e(){var b,c,d,e,f,g;if(b=1<=arguments.length?Array.prototype.slice.call(arguments,0):[],d=b.shift(),d=h+d,e=a.eventsCallbacks[d]){for(f=0,g=e.length;g>f;f++)c=e[f],c.apply(null,b);return!0}}function f(b,c){var d,e,f,g,i,j;if(!b)return h||(a.eventsCallbacks={}),j=Object.keys(a.eventsCallbacks),j=j.filter(function(a){return 0===a.indexOf(h)}),void j.forEach(function(b){delete a.eventsCallbacks[b]});if(b=h+b,f=a.eventsCallbacks[b]){if(!c)return void delete a.eventsCallbacks[b];for(e=g=0,i=f.length;i>g;e=++g)if(d=f[e],d===c){f=f.slice(),f.splice(e,1),a.eventsCallbacks[b]=f;break}}}var g=a,h="";b=b||{},a.eventsCallbacks||(a.eventsCallbacks={}),b.context&&(g=b.context,h=b.namespace+":"),g.bind=c,g.on=c,g.one=d,g.trigger=e,g.unbind=f,g.off=f}},{}],55:[function(a,b){b.exports={error:a("./error"),events:a("./events"),store:a("./store"),task:a("./task")}},{"./error":51,"./events":54,"./store":57,"./task":60}],56:[function(a,b){var c=a("./scoped"),d=a("../events"),e=a("../error/error"),f=a("../error/object_type"),g=a("../error/object_id"),h=a("extend"),i=a("../../utils/");b.exports=function(b,j){function k(a){return h(a,n)}var l=a("../../utils/promise/is_promise"),m={},n={hoodie:b},o=j.name||"store",p=function t(a,d){var e=h(!0,{type:a,id:d},j);return c(b,t,e)};if(d(b,{context:p,namespace:o}),p.validate=j.validate,j.validate||(p.validate=function(a){if(!a)return new e({name:"InvalidObjectError",message:"No object passed."});if(f.isInvalid(a.type,r))return new f({type:a.type,rules:s});if(a.id)return g.isInvalid(a.id,r)?new g({id:a.id,rules:s}):void 0}),p.save=i.toPromise(function(a,b,c,d,e){d=d?h(!0,{},d):{};var f=h(!0,{},c,{type:a,id:b}),g=p.validate(f,d||{});return g?e(g):k(m.save(f,d||{}))}),p.add=function(a,b,c){return void 0===b&&(b={}),c=c||{},p.save(a,b.id,b,c)},p.find=function(a,b){return k(m.find(a,b))},p.findOrAdd=function(a,b,c){function d(){var d;return d=h(!0,{id:b},c),p.add(a,d)}null===c&&(c={});var e=p.find(a,b).then(null,d);return k(e)},p.findAll=function(a,b){return k(m.findAll(a,b))},p.update=i.toPromise(function(a,b,c,d,e){function f(f){var g,i,j;return i=h(!0,{},f),"function"==typeof c&&(c=c(i)),c?(g=function(){var a=[];for(var b in c)if(c.hasOwnProperty(b)){if(j=c[b],f[b]===j)continue;i[b]=j,a.push(b)}return a}(),g.length||d?p.save(a,b,i,d):e(i)):e(f)}var g=p.find(a,b).then(f);return k(g)}),p.updateOrAdd=function(a,b,c,d){function e(){var e=h(!0,{},c,{id:b});return p.add(a,e,d)}var f=p.update(a,b,c,d).then(null,e);return k(f)},p.updateAll=i.toPromise(function(a,b,c,d){var e;switch(c=c||{},!0){case"string"==typeof a:e=p.findAll(a);break;case l(a):e=a;break;case $.isArray(a):e=d(a);break;default:e=p.findAll()}return e=e.then(function(a){var e,f;return $.isArray(a)||(a=[a]),f=function(){var d,f,g;for(g=[],d=0,f=a.length;f>d;d++)e=a[d],g.push(p.update(e.type,e.id,b,c));return g}(),d(null,f)}),k(e)}),p.remove=function(a,b,c){return k(m.remove(a,b,c||{}))},p.removeAll=function(a,b){return k(m.removeAll(a,b||{}))},p.decoratePromises=function(a){return h(n,a)},!j.backend)throw new Error("options.backend must be passed");var q="save find findAll remove removeAll".split(" ");q.forEach(function(a){if(!j.backend[a])throw new Error("options.backend."+a+" must be passed.");m[a]=j.backend[a]});var r=/^[^\/]+$/,s="/ not allowed";return p}},{"../../utils/":65,"../../utils/promise/is_promise":69,"../error/error":50,"../error/object_id":52,"../error/object_type":53,"../events":54,"./scoped":59,extend:40}],57:[function(a,b){b.exports={api:a("./api"),remote:a("./remote"),scoped:a("./scoped")}},{"./api":56,"./remote":58,"./scoped":59}],58:[function(a,b){var c="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},d=a("./api"),e=a("extend"),f=a("../../utils/generate_id"),g=a("../../utils/");b.exports=function(a,b){function h(a){return"function"==typeof z?z(a):z=a}function i(a){var b,c;c=e({},a);for(b in c)if(c.hasOwnProperty(b)){if(-1!==G.indexOf(b))continue;if(!/^_/.test(b))continue;delete c[b]}return c._id=""+c.type+"/"+c.id,w.prefix&&(c._id=""+w.prefix+c._id),delete c.id,c}function j(a){var b,c;return b=a._id||a.id,delete a._id,w.prefix&&(b=b.replace(y,"")),c=b.match(/([^\/]+)\/(.*)/),a.type=c[1],a.id=c[2],a}function k(a){return a.map(j)}function l(a){var b,c,d,e;try{e=a._rev.split(/-/),c=e[0],b=e[1]}catch(f){}return c=parseInt(c,10)||0,d=m(),a._$local&&(d+="-local"),a._rev=""+(c+1)+"-"+d,a._revisions={start:1,ids:[d]},b?(a._revisions.start+=c,a._revisions.ids.push(b)):void 0}function m(){return f(9)}function n(a){return a.rows.map(function(a){return a.doc})}function o(){var a;return a=w.getSinceNr(),w.isConnected()&&!A?"/_changes?include_docs=true&since="+a+"&heartbeat=10000&feed=longpoll":"/_changes?include_docs=true&since="+a}function p(){B&&B.abort()}function q(a){return h(a.last_seq),u(a.results),w.isConnected()?w.pull():void 0}function r(b,d){if(w.isConnected())switch(b.status){case 401:return w.trigger("error:unauthenticated",d),w.disconnect();case 404:return c.setTimeout(w.pull,3e3);case 500:return w.trigger("error:server",d),c.setTimeout(w.pull,3e3),a.checkConnection();default:return"abort"===b.statusText?w.pull():(c.setTimeout(w.pull,3e3),a.checkConnection())}}function s(){A=!1,w.trigger("bootstrap:end")}function t(a){A=!1,w.trigger("bootstrap:error",a)}function u(a){for(var b,c,d,e=0;e<a.length;e++)if(b=a[e].doc,!(w.prefix&&0!==b._id.indexOf(w.prefix)||E[b._rev])){if(d=j(b),d._deleted){if(!w.isKnownObject(d))continue;c="remove",w.isKnownObject(d)}else w.isKnownObject(d)?c="update":(c="add",w.markAsKnownObject(d));w.trigger(c,d),w.trigger(c+":"+d.type,d),w.trigger(c+":"+d.type+":"+d.id,d),w.trigger("change",c,d),w.trigger("change:"+d.type,c,d),w.trigger("change:"+d.type+":"+d.id,c,d)}E={}}var v={};v.find=function(a,b){var c;return c=a+"/"+b,w.prefix&&(c=w.prefix+c),c="/"+encodeURIComponent(c),w.request("GET",c).then(j)},v.findAll=function(a){var b,c,d;switch(c="/_all_docs?include_docs=true",!0){case void 0!==a&&""!==w.prefix:d=w.prefix+a+"/";break;case void 0!==a:d=a+"/";break;case""!==w.prefix:d=w.prefix;break;default:d=""}return d&&(b=d.replace(/.$/,function(a){var b;return b=a.charCodeAt(0),String.fromCharCode(b+1)}),c=""+c+'&startkey="'+encodeURIComponent(d)+'"&endkey="'+encodeURIComponent(b)+'"'),w.request("GET",c).then(n).then(k)},v.save=function(a){var b;return a.id||(a.id=f()),a=i(a),b="/"+encodeURIComponent(a._id),w.request("PUT",b,{data:a})},v.remove=function(a,b){return w.update(a,b,{_deleted:!0})},v.removeAll=function(a){return w.updateAll(a,{_deleted:!0})};var w=d(a,{name:b.name,backend:{save:v.save,find:v.find,findAll:v.findAll,remove:v.remove,removeAll:v.removeAll}}),x=null;w.connected=!1,w.prefix="";var y=new RegExp("^");void 0!==b.name&&(x=b.name),void 0!==b.prefix&&(w.prefix=b.prefix,y=new RegExp("^"+w.prefix)),null!==b.baseUrl&&(w.baseUrl=b.baseUrl),w.request=function(b,c,d){return d=d||{},x&&(c="/"+encodeURIComponent(x)+c),w.baseUrl&&(c=""+w.baseUrl+c),d.contentType=d.contentType||"application/json",("POST"===b||"PUT"===b)&&(d.dataType=d.dataType||"json",d.processData=d.processData||!1,d.data=JSON.stringify(d.data)),a.request(b,c,d)},w.isKnownObject=function(a){var b=""+a.type+"/"+a.id;return void 0!==F[b]?F[b]:void 0},w.markAsKnownObject=function(a){var b=""+a.type+"/"+a.id;return F[b]=1,F[b]},w.connect=function(a){return a&&(x=a),w.connected=!0,w.trigger("connect"),w.bootstrap().then(function(){w.push()})},w.disconnect=function(){w.connected=!1,w.trigger("disconnect"),B&&B.abort(),D&&D.abort()},w.isConnected=function(){return w.connected};var z=b.since||0;w.getSinceNr=function(){return"function"==typeof z?z():z};var A=!1;w.bootstrap=function(){return A=!0,w.trigger("bootstrap:start"),w.pull().done(s).fail(t)};var B,C;w.pull=function(){return B=w.request("GET",o()),w.isConnected()&&(c.clearTimeout(C),C=c.setTimeout(p,25e3)),B.done(q).fail(r)};var D,E={};w.push=g.toPromise(function(a,b){var c,d=[];if($.isArray(a)||(a=H()),0===a.length)return b([]);a=a.map(function(a){return e(!0,{},a)}),d=[];for(var f=0;f<a.length;f++)c=a[f],l(c),c=i(c),d.push(c),E[c._rev]=1;return D=w.request("POST","/_bulk_docs",{data:{docs:d,new_edits:!1}}),D.done(function(){for(var b=0;b<a.length;b++)delete a[b]._revisions,w.trigger("push",a[b])}),D}),w.sync=function(a){return w.push(a).then(w.pull)};var F={},G=["_id","_rev","_deleted","_revisions","_attachments"],H=function(){return[]};if(b.defaultObjectsToPush&&(H=$.isArray(b.defaultObjectsToPush)?function(){return b.defaultObjectsToPush}:b.defaultObjectsToPush),b.knownObjects)for(var I=0;I<b.knownObjects.length;I++)w.markAsKnownObject({type:b.knownObjects[I].type,id:b.knownObjects[I].id});return w}},{"../../utils/":65,"../../utils/generate_id":63,"./api":56,extend:40}],59:[function(a,b){var c=a("../events");b.exports=function(a,b,d){var e=d.name||"store",f=d.type,g=d.id,h={};return g||(c(a,{context:h,namespace:e+":"+f}),h.save=function(a,c,d){return b.save(f,a,c,d)},h.add=function(a,c){return b.add(f,a,c)},h.find=function(a){return b.find(f,a)},h.findOrAdd=function(a,c){return b.findOrAdd(f,a,c)},h.findAll=function(a){return b.findAll(f,a)},h.update=function(a,c,d){return b.update(f,a,c,d)},h.updateAll=function(a,c){return b.updateAll(f,a,c)},h.remove=function(a,c){return b.remove(f,a,c)},h.removeAll=function(a){return b.removeAll(f,a)}),g&&(c(a,{context:h,namespace:e+":"+f+":"+g}),h.save=function(a,c){return b.save(f,g,a,c)},h.find=function(){return b.find(f,g)},h.update=function(a,c){return b.update(f,g,a,c)},h.remove=function(a){return b.remove(f,g,a)}),h.decoratePromises=b.decoratePromises,h.validate=b.validate,h}},{"../events":54}],60:[function(a,b){b.exports={scoped:a("./scoped")}},{"./scoped":61}],61:[function(a,b){var c=a("../events");b.exports=function(a,b,d){var e=d.type,f=d.id,g={};return f||(c(a,{context:g,namespace:"task:"+e}),g.start=function(a){return b.start(e,a)},g.abort=function(a){return b.abort(e,a)},g.restart=function(a,c){return b.restart(e,a,c)},g.abortAll=function(){return b.abortAll(e)},g.restartAll=function(a){return b.restartAll(e,a)}),f&&(c(a,{context:g,namespace:"task:"+e+":"+f}),g.abort=function(){return b.abort(e,f)},g.restart=function(a){return b.restart(e,f,a)}),g}},{"../events":54}],62:[function(a,b){function c(){d=e.getObject(h)||{}}var d,e=a("../utils/local_storage_wrapper"),f=a("extend"),g={},h="_hoodie_config";g.set=function(a,b){d[a]=b,e.setObject(h,d)},g.get=function(a){return a?d[a]:f({},d)},g.clear=function(){return d={},e.removeItem(h)},g.unset=function(a){delete d[a],e.setObject(h,d)},c(),b.exports=g},{"../utils/local_storage_wrapper":66,extend:40}],63:[function(a,b){function c(a){var b="";for(void 0===a&&(a=7),e=0;a>e;e++){var c=Math.random()*f,g=d[Math.floor(c)];b+=String(g).charAt(0)}return b}var d,e,f;d="0123456789abcdefghijklmnopqrstuvwxyz".split(""),f=d.length,b.exports=c},{}],64:[function(a,b){function c(a){return a=a.replace(d,function(a){return(a[1]||a[0]).toUpperCase()
}),"Hoodie"+a+"Error"}var d=/(^\w|_\w)/g;b.exports=c},{}],65:[function(a,b,c){var d=a("__browserify_process"),e="undefined"!=typeof self?self:"undefined"!=typeof window?window:{};c.Promise="function"==typeof e.Promise?e.Promise:a("bluebird");var f=c.Promise;c.config=a("./config"),c.generate_id=a("./generate_id"),c.local_storage_wrapper=a("./local_storage_wrapper"),c.promise=a("./promise"),c.getArguments=a("argsarray"),c.once=function(a){var b=!1;return c.getArguments(function(c){if(b)throw"function"==typeof console.trace&&console.trace(),new Error("once called  more than once");b=!0,a.apply(this,c)})},c.toPromise=function(a){return c.getArguments(function(b){var e,g=this,h="function"==typeof b[b.length-1]?b.pop():!1;h&&(e=function(a,b){d.nextTick(function(){h(a,b)})});var i=new f(function(d,e){var f;try{var h=c.once(function(a,b){a?e(a):d(b)});b.push(h),f=a.apply(g,b),f&&"function"==typeof f.then&&d(f)}catch(i){e(i)}});return e&&i.then(function(a){e(null,a)},e),i.cancel=function(){return this},i})}},{"./config":62,"./generate_id":63,"./local_storage_wrapper":66,"./promise":68,__browserify_process:39,argsarray:1,bluebird:4}],66:[function(a,b,c){function d(){c.isPersistent||(c.getItem=function(){return null},c.setItem=function(){return null},c.removeItem=function(){return null},c.key=function(){return null},c.length=function(){return 0},c.isPersistent=function(){return!1})}var e="undefined"!=typeof self?self:"undefined"!=typeof window?window:{};c.setItem=function(a,b){e.localStorage.setItem(a,b)},c.getItem=function(a){return e.localStorage.getItem(a)},c.removeItem=function(a){return e.localStorage.removeItem(a)},c.clear=function(){return e.localStorage.clear()},c.key=function(a){return e.localStorage.key(a)},c.length=function(){return e.localStorage.length},c.setObject=function(a,b){return c.setItem(a,e.JSON.stringify(b))},c.getObject=function(a){var b=c.getItem(a);if(!b)return null;try{return e.JSON.parse(b)}catch(d){return null}},c.isPersistent=function(){try{if(!e.localStorage)return!1;if(localStorage.setItem("Storage-Test","1"),"1"!==localStorage.getItem("Storage-Test"))return!1;localStorage.removeItem("Storage-Test")}catch(a){return!1}return!0},d()},{}],67:[function(a,b){var c="undefined"!=typeof self?self:"undefined"!=typeof window?window:{};b.exports=c.jQuery.Deferred},{}],68:[function(a,b){b.exports={defer:a("./defer"),isPromise:a("./is_promise"),rejectWith:a("./reject_with"),reject:a("./reject"),resolveWith:a("./resolve_with"),resolve:a("./resolve")}},{"./defer":67,"./is_promise":69,"./reject":70,"./reject_with":71,"./resolve":72,"./resolve_with":73}],69:[function(a,b){function c(a){return!(!a||"function"!=typeof a.done||"function"==typeof a.resolve)}b.exports=c},{}],70:[function(a,b){function c(){return d().reject().promise()}var d=a("./defer");b.exports=c},{"./defer":67}],71:[function(a,b){function c(a){var b=new e(a);return d().reject(b).promise()}var d=a("./defer"),e=a("../../lib/error/error");b.exports=c},{"../../lib/error/error":50,"./defer":67}],72:[function(a,b){function c(){return d().resolve().promise()}var d=a("./defer");b.exports=c},{"./defer":67}],73:[function(a,b){function c(){var a=d();return a.resolve.apply(a,arguments).promise()}var d=a("./defer");b.exports=c},{"./defer":67}]},{},[41])(41)});